mutate(
treatl3 = ifelse( time_elec <= -3, 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0) #elec more than three years ago
)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3, 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0) #elec more than three years ago
)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
rwa_long.3 <- rwa_long.2 %>%
filter(!is.na(year_first)) %>%
mutate(
year_first = case_when(
year_first == 2010 ~ 1900,
.default = year_first
)
)
sum(is.na(rwa_long.3$year_first))
rwa_long.3 <- rwa_long.3 %>%
mutate(
Year = as.numeric(Year),
year_first =as.numeric(year_first)
) %>%
mutate(time_elec = Year - year_first)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3, 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0) #elec more than three years ago
)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
View(rwa_long_check)
View(rwa_long.3)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 &  & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
# Fit the lm model
model_es_lm <- lm(Value ~ treatl3 + treatl2 + treatl1 + treatp0 + treatp1 + treatp2 + treatp3, data = rwa_long.3)
# View the summary of the model
summary(model_es_lm)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3, 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
# treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0) #elec more than three years ago
)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
# Fit the lm model
model_es_lm <- lm(Value ~ treatl3 + treatl2  + treatp0 + treatp1 + treatp2 + treatp3, data = rwa_long.3)
# View the summary of the model
summary(model_es_lm)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
View(rwa_long_check)
##graph----
coefs <- coef(summary(model_es_lm))
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
View(coefs_df)
View(coefs_df)
##graph----
coefs <- coef(summary(model_es_feols))
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
##graph----
coefs <- coef(summary(model_es_feo))
##graph----
coefs <- coef(summary(model_es_fe))
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
View(coefs)
##graph----
coefs <- coef(summary(model_es_lm))
coefs <- coef(summary(model_es_lm))
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
##graph----
coefs <- coef(summary(model_es_lm))
View(coefs)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3, 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0) #elec more than three years ago
)
# Fit the lm model
model_es_lm <- lm(Value ~ treatl3 + treatl2  + treatl1 + treatp0 + treatp1 + treatp2 + treatp3, data = rwa_long.3)
# View the summary of the model
summary(model_es_lm)
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- coefs_df %>%
rename(treatl1 = `(Intercept)`) %>%
arrange(Term) %>%
mutate(
Estimate = Estimate + 9.00012 + 4.98513
)
# View the summary of the model
summary(model_es_lm)
##graph----
coefs <- coef(summary(model_es_lm))
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- coefs_df %>%
arrange(Term) %>%
mutate(
Estimate = Estimate + 9.00012 + 4.98513
)
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = estimate - 1.96 * se, ymax = estimate + 1.96 * se),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = Estimate - 1.96 * Std.Error, ymax = Estimate + 1.96 *  Std.Error),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == `(Intercept)`, "treatp3", Term)
)
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == `(Intercept)`, "treatp3", Term)
) %>%
arrange(Term) %>%
mutate(
Estimate = Estimate + 9.00012 + 4.98513
)
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == "(Intercept)", "treatp3", Term)
) %>%
arrange(Term) %>%
mutate(
Estimate = Estimate + 9.00012 + 4.98513
)
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = Estimate - 1.96 * Std.Error, ymax = Estimate + 1.96 *  Std.Error),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == "(Intercept)", "treatp3", Term)
) %>%
arrange(Term) %>%
mutate(
Estimate = ifelse(Term != "treatp3", Estimate + 9.00012)
)
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == "(Intercept)", "treatp3", Term)
) %>%
arrange(Term) %>%
mutate(
Estimate = ifelse(Term != "treatp3", Estimate + 9.00012, Estimate)
)
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = Estimate - 1.96 * Std.Error, ymax = Estimate + 1.96 *  Std.Error),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == "(Intercept)", "treatp3", Term)
) %>%
mutate(
Term = factor(Term, levels = c("treatl3", "treatl2", "treatl1", "treatp0", "treatp1", "treatp2", "treatp3"))
) %>%
arrange(Term) %>%
mutate(
Estimate = ifelse(Term != "treatp3", Estimate + 9.00012, Estimate)
)
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = Estimate - 1.96 * Std.Error, ymax = Estimate + 1.96 *  Std.Error),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
rwa_long.3 <- rwa_long.2 %>%
filter(!is.na(year_first)) %>%
mutate(
year_first = case_when(
year_first == 2010 ~ 1900,
is.na(year_first) ~ 2300,
.default = year_first
)
)
sum(is.na(rwa_long.3$year_first))
rwa_long.3 <- rwa_long.3 %>%
mutate(
Year = as.numeric(Year),
year_first =as.numeric(year_first)
) %>%
mutate(time_elec = Year - year_first)
View(rwa_long.3)
rwa_long.3 <- rwa_long.2 %>%
filter(!is.na(year_first)) %>%
mutate(
year_first = case_when(
year_first == 2010 ~ 1900,
is.na(year_first) ~ 2300,
.default = year_first
)
)
rwa_long.3 <- rwa_long.3 %>%
mutate(
Year = as.numeric(Year),
year_first =as.numeric(year_first)
) %>%
mutate(time_elec = Year - year_first)
rwa_long.3 <- rwa_long.2 %>%
# filter(!is.na(year_first)) %>%
mutate(
year_first = case_when(
year_first == 2010 ~ 1900,
is.na(year_first) ~ 2300,
.default = year_first
)
)
rwa_long.3 <- rwa_long.3 %>%
mutate(
Year = as.numeric(Year),
year_first =as.numeric(year_first)
) %>%
mutate(time_elec = Year - year_first)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3 & >= -30 , 1, 0), # elec 3 or more years in the future
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
View(rwa_long_check)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3 & time_elec>= -30 , 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0) #elec more than three years ago
)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
sum(is.na(rwa_long.3$year_first))
sum(is.na(rwa_long.3$connect_vt))
model_es_lm <- lm(Value ~ treatl3 + treatl2  + treatl1 + treatp0 + treatp1 + treatp2 + treatp3, data = rwa_long.3)
# View the summary of the model
summary(model_es_lm)
stargazer(
model_es,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
# stars = TRUE,
out = file.path(output_path, "es_usage_lm.html"))
###Fit the fixed effect model----
model_es_fe <- feols(Value ~ treatl3 + treatl2 + treatl1 +  treatp0 + treatp1 + treatp2 + treatp3|as.factor(Village_ID), data = rwa_long.3)
# View the summary of the model
summary(model_es_fe)
modelsummary(
model_es_fe,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
stars = TRUE,
out = file.path(output_path, "es_usage_feols.html"))
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
rwa_long.3 <- rwa_long.3 %>%
mutate(
treatl3 = ifelse( time_elec <= -3 & time_elec>= -30 , 1, 0), # elec 3 or more years in the future
treatl2 = ifelse( time_elec == -2, 1, 0), #elec 2 years in the future
treatl1 = ifelse( time_elec == -1, 1, 0), #elec 2 years in the future
treatp0 = ifelse( time_elec == 0, 1, 0), #elec this year
treatp1 = ifelse( time_elec == 1, 1, 0), #elec last year
treatp2 = ifelse( time_elec ==  2, 1, 0), # elec last two years
treatp3 = ifelse( time_elec >= 3, 1, 0), #elec more than three years ago
notreat = ifelse( time_elec <= -30 , 1, 0), # elec 3 or more years in the future
)
rwa_long_check <- rwa_long.3 %>%
filter(
treatl3 == 0 & treatl2 == 0 & treatl1 == 0 & treatp0 == 0 & treatp1 ==0 & treatp2 ==0 & treatp3 == 0
)
# Fit the lm model
model_es_lm <- lm(Value ~ treatl3 + treatl2  + treatl1 + treatp0 + treatp1 + treatp2 + treatp3, data = rwa_long.3)
# View the summary of the model
summary(model_es_lm)
stargazer(
model_es,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
# stars = TRUE,
out = file.path(output_path, "es_usage_lm.html"))
stargazer(
model_es_lm,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
# stars = TRUE,
out = file.path(output_path, "es_usage_lm.html"))
model_es_fe <- feols(Value ~ treatl3 + treatl2 + treatl1 +  treatp0 + treatp1 + treatp2 + treatp3|as.factor(Village_ID), data = rwa_long.3)
# View the summary of the model
summary(model_es_fe)
modelsummary(
model_es_fe,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
stars = TRUE,
out = file.path(output_path, "es_usage_feols.html"))
###Fit the fixed effect model----
model_es_fe <- feols(Value ~ treatl3 + treatl2 + treatl1 +  treatp0 + treatp1 + treatp2 + treatp3 + notreat |as.factor(Village_ID), data = rwa_long.3)
# View the summary of the model
summary(model_es_fe)
coefs <- coef(summary(model_es_lm))
coefs_df <- data.frame(
Term = rownames(coefs),
Estimate = coefs[, 1],
Std.Error = coefs[, 2]
)
coefs_df <- coefs_df %>%
mutate(
Term = ifelse(Term == "(Intercept)", "notreat", Term)
) %>%
mutate(
Term = factor(Term, levels = c("notreat", "treatl3", "treatl2", "treatl1", "treatp0", "treatp1", "treatp2", "treatp3"))
) %>%
arrange(Term) %>%
mutate(
Estimate = ifelse(Term != "notreat", Estimate + 1.379, Estimate)
)
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = Estimate - 1.96 * Std.Error, ymax = Estimate + 1.96 *  Std.Error),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
rwa_long.4 <- rwa_long.3 %>%
filter(year != 2300)
rwa_long.4 <- rwa_long.3 %>%
filter(Year != 2300)
model_es_fe <- feols(Value ~ treatl3 + treatl2 + treatl1 +  treatp0 + treatp1 + treatp2 + treatp3 |as.factor(Village_ID), data = rwa_long.4)
model_es_fe <- feols(Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 |as.factor(Village_ID), data = rwa_long.4)
# View the summary of the model
summary(model_es_fe)
ggplot(coefs_df, aes(x = Term, y = Estimate)) +
geom_point() +
geom_errorbar(aes(ymin = Estimate - 1.96 * Std.Error, ymax = Estimate + 1.96 *  Std.Error),
colour = "black", width = 0.1, position = position_dodge(0.1)) +
geom_line() +
geom_hline(yintercept = 0.0, linetype = "dashed") +
labs(title = "Event Study Plot for usage",
x = "Year",
y = "Coefficient")
rwa_long.3 %>% filter(year_first == 2013) %>% head(30)
rwa_long.3 %>% filter(year_first == 2013) %>% data.frame %>% head(20)
library(lfe)
rwa_long.3 %>% filter(year_first > 1900) %>% filter(year >= 2010) %>%
felm(formula = Value ~ treatl3 + treatl2 + treatl1 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + year | 0 | Village_id)
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
felm(formula = Value ~ treatl3 + treatl2 + treatl1 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + year | 0 | Village_id)
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
felm(formula = Value ~ treatl3 + treatl2 + treatl1 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year | 0 | Village_id)
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
felm(formula = Value ~ treatl3 + treatl2 + treatl1 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year | 0 | Village_ID)
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
felm(formula = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year | 0 | Village_ID)
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
felm(formula = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year | 0 | Village_ID) %>% summary()
?feosl
?feols
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
feols(fml = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year, cluster = "Village_ID") %>% summary()
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
feols(fml = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID, cluster = "Village_ID") %>% summary()
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
feols(fml = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year, cluster = "Village_ID") %>% summary()
###Fit the fixed effect model----
rwa_long.3 %>% filter(year_first > 1900) %>% filter(Year >= 2010) %>%
+     feols(fml = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year, cluster = "Village_ID") %>% summary()
###Fit the fixed effect model----
model_es_fe <- rwa_long.3 %>%
filter(year_first > 1900) %>%
filter(Year >= 2010) %>%
feols(fml = Value ~ treatl3 + treatl2 + treatp0 + treatp1 + treatp2 + treatp3 | Village_ID + Year, cluster = "Village_ID") %>% summary()
# View the summary of the model
summary(model_es_fe)
modelsummary(
model_es_fe,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
stars = TRUE,
out = file.path(output_path, "es_usage_feols.html"))
modelsummary(
model_es_fe,
type = "html",
title = "Table: Events Study Village and Year(including already electrified first year)",
stars = TRUE,
out = file.path(output_path, "es_usage_feols.html"))
write_xlsx(rwa_long.3, file.path(data_path, "rwa_long_0501.xlsx"))
