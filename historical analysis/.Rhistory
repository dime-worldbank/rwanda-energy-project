) %>%
mutate(
sum = has_village_id + no_village_id,
fract_villageid = round(has_village_id/sum, 2)
)
View(year_wide)
district_fraction <- usage_year %>%
group_by(district, id_exist) %>%
summarise(
usage_sum = sum(usage)
)
district_wide <- district_fraction %>%
pivot_wider(
names_from= id_exist,
values_from = usage_sum
)
district_wide <- district_wide %>%
rename(
has_village_id = `1`,
no_village_id = `0`
) %>%
mutate(
sum = has_village_id + no_village_id,
fract_villageid = round(has_village_id/sum, 2)
)
View(district_wide)
dy_fraction <- usage_year %>%
group_by(district, year, id_exist) %>%
summarise(
usage_sum = sum(usage)
)
dy_wide <- dy_fraction %>%
pivot_wider(
names_from= id_exist,
values_from = usage_sum
)
dy_wide <- dy_wide %>%
rename(
has_village_id = `1`,
no_village_id = `0`
) %>%
mutate(
sum = has_village_id + no_village_id,
fract_villageid = round(has_village_id/sum, 2)
)
write_xlsx(list("district" = district_wide, "year" = year_wide, "district and year" = dy_wide) , path = file.path(data_path, "fraction of usage.xlsx"))
View(usage_id)
View(usage_id_0409)
usage_unique <- rbind(usage_id_0412, usage_noid_0412)
View(usage_unique)
gc()
usage_id <- read_xlsx(path = file.path(data_path, "usage_id_0412.xlsx"))
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, haven, stringr, gtsummary)
#read file----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
data_path <- file.path(
DROPBOX, "Rwanda Energy/datawork/Historical data"
)
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, haven, stringr, gtsummary)
#read file----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
data_path <- file.path(
DROPBOX, "Rwanda Energy/datawork/Historical data"
)
usage_id <- read_xlsx(path = file.path(data_path, "usage_id_0412.xlsx"))
usage_noid <- read_xlsx(path = file.path(data_path, "usage_noid_0412.xlsx"))
usage_unique <- rbind(usage_id, usage_noid)
karongi_meter <- st_read(dsn = file.path(data_path, "eucl meter", "karongi_meter.shp"))
rulindo_meter <- st_read(dsn = file.path(data_path, "eucl meter", "rulindo_meter.shp"))
rutsiro_meter <- st_read(dsn = file.path(data_path, "eucl meter", "rutsiro_meter.shp"))
rusizi_meter <- st_read(dsn = file.path(data_path, "eucl meter", "rusizi_meter.shp"))
##Karongi join----
karongi_meter <- karongi_meter %>%
clean_names()
karongi_location <- karongi_meter %>%
select(village_id, plot_numbe, meter_numb)
karongi_location <- karongi_location %>%
mutate(meter_numb = as.character(meter_numb)) %>%
distinct(meter_numb, .keep_all = TRUE)
n_distinct(karongi_location$meter_numb) == nrow(karongi_location)
View(karongi_location)
karongi_parcel <- karongi_meter %>%
filter(!is.na(Plot_Numbe)) %>%
clean_names()
karongi_parcel <- karongi_meter %>%
filter(!is.na(plot_numbe)) %>%
clean_names()
nrow(karongi_parcel)
karongi_parcel$plot_numbe <- gsub("/", "", karongi_parcel$plot_numbe)
karongi_parcel$parcel_id<- paste0(substr(karongi_parcel$plot_numbe, 1, 1), substr(karongi_parcel$plot_numbe, 3, 7))
karongi_success <- karongi_parcel %>%
filter(parcel_id == cell_id)
nrow(karongi_success)
karongi_unsucces <- karongi_parcel %>%
filter(parcel_id != cell_id)
nrow(karongi_unsucces)
sum(is.na(rutsiro_meter$Plot_Numbe))
rutsiro_parcel <- rutsiro_meter %>%
filter(!is.na(plot_numbe)) %>%
clean_names()
rusizi_meter <- rusizi_meter %>%
clean_names()
rutsiro_meter <- rutsiro_meter %>%
clean_names()
rulindo_meter <- rulindo_meter %>%
clean_names()
rutsiro_parcel <- rutsiro_meter %>%
filter(!is.na(plot_numbe)) %>%
clean_names()
nrow(rutsiro_parcel)
rutsiro_parcel$plot_numbe <- gsub("/", "", rutsiro_parcel$plot_numbe)
rutsiro_parcel$parcel_id<- paste0(substr(rutsiro_parcel$plot_numbe, 1, 1), substr(rutsiro_parcel$plot_numbe, 3, 7))
rutsiro_success <- rutsiro_parcel %>%
filter(parcel_id == cell_id)
nrow(rutsiro_success)
rutsiro_unsucces <- rutsiro_parcel %>%
filter(parcel_id != cell_id)
nrow(rutsiro_unsucces)
sum(is.na(rulindo_meter$Plot_Numbe))
rulindo_parcel <- rulindo_meter %>%
filter(!is.na(plot_numbe)) %>%
clean_names()
nrow(rulindo_parcel)
rulindo_parcel$plot_numbe <- gsub("/", "", rulindo_parcel$plot_numbe)
rulindo_parcel$parcel_id<- paste0(substr(rulindo_parcel$plot_numbe, 1, 1), substr(rulindo_parcel$plot_numbe, 3, 7))
rulindo_success <- rulindo_parcel %>%
filter(parcel_id == cell_id)
nrow(rulindo_success)
rulindo_unsucces <- rulindo_parcel %>%
filter(parcel_id != cell_id)
nrow(rulindo_unsucces)
sum(is.na(rusizi_meter$Plot_Numbe))
rusizi_parcel <- rusizi_meter %>%
filter(!is.na(plot_numbe)) %>%
clean_names()
nrow(rusizi_parcel)
rusizi_parcel$plot_numbe <- gsub("/", "", rusizi_parcel$plot_numbe)
rusizi_parcel$parcel_id<- paste0(substr(rusizi_parcel$plot_numbe, 1, 1), substr(rusizi_parcel$plot_numbe, 3, 7))
rusizi_success <- rusizi_parcel %>%
filter(parcel_id == cell_id)
nrow(rusizi_success)
rusizi_unsucces <- rusizi_parcel %>%
filter(parcel_id != cell_id)
nrow(rusizi_unsucces)
View(rusizi_success)
parcel_success <- rbind(karongi_sucess, rutsiro_success, rusizi_success, rulindo_success)
parcel_success <- rbind(karongi_success, rutsiro_success, rusizi_success, rulindo_success)
#all----
karongi_success.1 <- karongi_success %>%
st_drop_geometry
rutsiro_success.1 <- rutsiro_success %>%
st_drop_geometry()
rulindo_success.1 <- rulindo_success %>%
st_drop_geometry()
rusizi_success.1 <- rusizi_success %>%
st_drop_geometry()
parcel_success <- rbind(karongi_success.1, rutsiro_success.1, rusizi_success.1, rulindo_success.1)
View(karongi_success.1)
#all----
karongi_success.1 <- karongi_success %>%
st_drop_geometry() %>%
select(meter_numbe, plot_numbe, village_id, parcel_id)
#all----
karongi_success.1 <- karongi_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id)
()%>%
rutsiro_success.1 <- rutsiro_success %>%
st_drop_geometry()%>%
select(meter_numb, plot_numbe, village_id, parcel_id)
rulindo_success.1 <- rulindo_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id)
rusizi_success.1 <- rusizi_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id)
parcel_success <- rbind(karongi_success.1, rutsiro_success.1, rusizi_success.1, rulindo_success.1)
write_xlsx(parcel_sucess, path = file.path(data_path, "parcel_success.xlsx"))
write_xlsx(parcel_success, path = file.path(data_path, "parcel_success.xlsx"))
parcel_success <- read_xlsx(path = file.path(data_path, "parcel_success.xlsx"))
parcel_join <- parcel_success %>%
select(meter_numb, parcel_id, plot_numbe)
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_Id" = "meter_numb"))
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_id" = "meter_numb"))
parcel_join <- parcel_success %>%
select(meter_numb, parcel_id, plot_numbe) %>%
mutate(
meter_numb = as.character(meter_numb)
)
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_id" = "meter_numb"))
filter <- usage_unique %>%
filter(!is.na(parcel_id)&is.na(village_id))
View(filter)
parcel_join <- parcel_success %>%
select(meter_numb, parcel_id, plot_numbe, village_id) %>%
mutate(
meter_numb = as.character(meter_numb)
)
parcel_join <- parcel_success %>%
select(meter_numb, parcel_id, plot_numbe, village_id, district) %>%
mutate(
meter_numb = as.character(meter_numb)
)
#all----
karongi_success.1 <- karongi_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
rutsiro_success.1 <- rutsiro_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
rulindo_success.1 <- rulindo_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
rusizi_success.1 <- rusizi_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
parcel_success <- rbind(karongi_success.1, rutsiro_success.1, rusizi_success.1, rulindo_success.1)
write_xlsx(parcel_success, path = file.path(data_path, "parcel_success.xlsx"))
parcel_success <- read_xlsx(path = file.path(data_path, "parcel_success.xlsx"))
parcel_join <- parcel_success %>%
select(meter_numb, parcel_id, plot_numbe, village_id, district) %>%
mutate(
meter_numb = as.character(meter_numb)
)
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_id" = "meter_numb"))
n_distinct(parcel_success$meter_numb) == nrow(parcel_success)
karongi_success.1 <- karongi_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
rutsiro_success.1 <- rutsiro_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
rulindo_success.1 <- rulindo_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
rusizi_success.1 <- rusizi_success %>%
st_drop_geometry() %>%
select(meter_numb, plot_numbe, village_id, parcel_id, district)
parcel_success <- rbind(karongi_success.1, rutsiro_success.1, rusizi_success.1, rulindo_success.1)
n_distinct(parcel_success$meter_numb) == nrow(parcel_success)
parcel_success <- parcel_success %>%
distinct(meter_numb, .keep_all = TRUE)
write_xlsx(parcel_success, path = file.path(data_path, "parcel_success.xlsx"))
parcel_success <- read_xlsx(path = file.path(data_path, "parcel_success.xlsx"))
parcel_join <- parcel_success %>%
select(meter_numb, parcel_id, plot_numbe, village_id, district) %>%
mutate(
meter_numb = as.character(meter_numb)
)
usage_unique <- rbind(usage_id_0412, usage_noid_0412)
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_id" = "meter_numb"))
usage_unique <- rbind(usage_id, usage_noid)
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_id" = "meter_numb"))
filter <- usage_unique %>%
filter(!is.na(parcel_id)&is.na(village_id))
View(usage_unique)
View(usage_id)
filter <- usage_unique %>%
filter(!is.na(parcel_id)&is.na(village_id.X))
filter <- usage_unique %>%
filter(!is.na(parcel_id)&is.na(village_id.x))
View(filter)
select(-district.y, village_id.x, village_id.y, plot_numbe.x, plot_numbe.y )
usage_unique <- usage_unique %>%
mutate(
village_id = ifelse(is.na(village_id.x), village_id.y, village_id.x),
plot_numbe = ifelse(is.na(plot_numbe.x), plot_numbe.y, plot_numbe.x)
) %>%
rename(
district = district.x
) %>%
select(-district.y, village_id.x, village_id.y, plot_numbe.x, plot_numbe.y )
usage_id_0416 <- usage_unique %>%
filter(!is.na(village_id))
usage_noid_0416 <- usage_unique %>%
filter(is.na(village_Id))
usage_noid_0416 <- usage_unique %>%
filter(is.na(village_id))
usage_unique <- usage_unique %>%
mutate(
village_id = ifelse(is.na(village_id.x), village_id.y, village_id.x),
plot_numbe = ifelse(is.na(plot_numbe.x), plot_numbe.y, plot_numbe.x)
) %>%
rename(
district = district.x
) %>%
select(-district.y, -village_id.x, -village_id.y, -plot_numbe.x, -plot_numbe.y )
usage_unique <- rbind(usage_id, usage_noid)
usage_unique <- left_join(usage_unique, parcel_join, by = c("meter_id" = "meter_numb"))
usage_unique <- usage_unique %>%
mutate(
village_id = ifelse(is.na(village_id.x), village_id.y, village_id.x),
plot_numbe = ifelse(is.na(plot_numbe.x), plot_numbe.y, plot_numbe.x)
) %>%
rename(
district = district.x
) %>%
select(-district.y, -village_id.x, -village_id.y, -plot_numbe.x, -plot_numbe.y )
filter <- usage_unique %>%
filter(!is.na(parcel_id)&is.na(village_id))
filter <- usage_unique %>%
filter(!is.na(parcel_id)&is.na(sector))
View(filter)
sum(is.na(usage_unique$sector))/nrow(usage_unique)
filter <- usage_unique %>%
filter(!is.na(village_id)&is.na(sector))
no_sector <- usage_unique %>%
filter(is.na(sector))
no_sector_join <- usage_unique %>%
filter(is.na(sector) & !Is.na(village_id))
no_sector_join <- usage_unique %>%
filter(is.na(sector) & !is.na(village_id))
nrow(no_sector_join)/nrow(no_sector)
fraction_calculate <- usage_unique %>%
select(meter_installed_year, district, village_id, ends_with("usage"), id_exist)
# 0416 Fraction calculate----
usage_unique.1 <- usage_unique %>%
mutate(
id_exist = ifelse(is.na(village_id), 0, 1)
)
fraction_calculate <- usage_unique %>%
select(meter_installed_year, district, village_id, ends_with("usage"), id_exist)
fraction_calculate <- usage_unique.1 %>%
select(meter_installed_year, district, village_id, ends_with("usage"), id_exist)
usage_long <- fraction_calculate %>%
pivot_longer(
cols = ends_with("usage"),
values_to = "usage",
names_to = "year"
)
View(usage_long)
usage_combine <- usage_long %>%
filter(year == "combine_usage")
###Fraction each year----
usage_year <- usage_long %>%
filter(year != "combine_usage")
year_fraction <- usage_year %>%
group_by(year, id_exist) %>%
summarise(
usage_sum = sum(usage)
)
year_wide <- year_fraction %>%
pivot_wider(
names_from= id_exist,
values_from = usage_sum
)
year_wide <- year_wide %>%
rename(
has_village_id = `1`,
no_village_id = `0`
) %>%
mutate(
sum = has_village_id + no_village_id,
fract_villageid = round(has_village_id/sum, 2)
)
View(year_wide)
##Fraction each district
district_fraction <- usage_year %>%
group_by(district, id_exist) %>%
summarise(
usage_sum = sum(usage)
)
district_wide <- district_fraction %>%
pivot_wider(
names_from= id_exist,
values_from = usage_sum
)
district_wide <- district_wide %>%
rename(
has_village_id = `1`,
no_village_id = `0`
) %>%
mutate(
sum = has_village_id + no_village_id,
fract_villageid = round(has_village_id/sum, 2)
)
View(district_wide)
##Fraction each dy
dy_fraction <- usage_year %>%
group_by(district, year, id_exist) %>%
summarise(
usage_sum = sum(usage)
)
dy_wide <- dy_fraction %>%
pivot_wider(
names_from= id_exist,
values_from = usage_sum
)
dy_wide <- dy_wide %>%
rename(
has_village_id = `1`,
no_village_id = `0`
) %>%
mutate(
sum = has_village_id + no_village_id,
fract_villageid = round(has_village_id/sum, 2)
)
write_xlsx(list("district" = district_wide, "year" = year_wide, "district and year" = dy_wide) , path = file.path(data_path, "fraction of usage.xlsx"))
district_low <- district_wide %>%
filter(fract_villageid < 0.5)
usage_lowid <- usage_unique %>%
filter(district %in% district_low$district)
View(usage_lowid)
View(district_low)
district_low <- district_wide %>%
filter(fract_villageid < 0.1)
usage_lowid <- usage_unique %>%
filter(district %in% district_low$district)
nrow(no_sector_join)/nrow(no_sector)
nrow(no_sector)/nrow(usage_unique)
test <- usage_lowid %>%
filter(is.na(village_id)) %>%
group_by(district, sector) %>%
summarise(n = n())
View(test)
test <- usage_lowid %>%
filter(is.na(village_id) & is.na(sector)) %>%
group_by(district) %>%
summarise(n = n())
View(test)
usage_lowid_stat <- usage_lowid %>%
group_by(district) %>%
summarise(
with_id = sum(!is.na(village_id)),
no_id = sum(is.na(village_id))
)
View(usage_lowid_stat)
usage_lowid_stat <- usage_lowid_stat %>%
mutate(
withid_fraction = round(with_id/(with_id + no_id),2)
)
usage_lowid_stat <- usage_lowid %>%
group_by(district) %>%
summarise(
with_id = sum(!is.na(village_id)),
no_id = sum(is.na(village_id)),
no_id_no_sector = sum(is.na(sector)&is.na(village_id))
)
usage_lowid_stat <- usage_lowid_stat %>%
mutate(
withid_fraction = round(with_id/(with_id + no_id),2)
)
district_low_join <- district_low %>%
select(district, fract_villageid) %>%
rename(
with_id_usage_fraction = fract_villageid
)
usage_lowid_stat <- left_join(usage_lowid_stat, district_low_join, by = c("district"))
yes_sector <- usage_unique %>%
filter(is.na(sector))
yes_sector_join <- usage_unique %>%
filter(is.na(sector) & !is.na(village_id))
nrow(yes_sector_join)/nrow(yes_sector)
nrow(yes_sector)/nrow(usage_unique)
yes_sector <- usage_unique %>%
filter(!is.na(sector))
yes_sector_join <- usage_unique %>%
filter(!is.na(sector) & !is.na(village_id))
nrow(yes_sector_join)/nrow(yes_sector)
nrow(yes_sector)/nrow(usage_unique)
usage_lowid_stat <- usage_lowid %>%
group_by(district) %>%
summarise(
with_id = sum(!is.na(village)),
no_id = sum(is.na(village)),
no_id_no_sector = sum(is.na(sector)&is.na(village))
)
usage_lowid_stat <- usage_lowid_stat %>%
mutate(
withid_fraction = round(with_id/(with_id + no_id),2)
)
district_low_join <- district_low %>%
select(district, fract_villageid) %>%
rename(
with_id_usage_fraction = fract_villageid
)
usage_lowid_stat <- left_join(usage_lowid_stat, district_low_join, by = c("district"))
usage_lowid_stat <- usage_lowid %>%
group_by(district) %>%
summarise(
with_id = sum(!is.na(village_id)),
no_id = sum(is.na(village_id)),
no_id_no_sector = sum(is.na(sector)&is.na(village_id))
)
usage_lowid_stat <- usage_lowid_stat %>%
mutate(
withid_fraction = round(with_id/(with_id + no_id),2)
)
district_low_join <- district_low %>%
select(district, fract_villageid) %>%
rename(
with_id_usage_fraction = fract_villageid
)
usage_lowid_stat.1 <- left_join(usage_lowid_stat, district_low_join, by = c("district"))
usage_lowid_stat <- left_join(usage_lowid_stat, district_low_join, by = c("district"))
write_xlsx(usage_lowid_stat, path = file.path(data_path, "clarification on low usage.xlsx"))
write_xlsx(no_sector, path = file.path(data_path, "usage no sector.xlsx"))
write.csv(usage_id_0416, path = file.path(data_path, "usage_id_0416.xlsx"))
write.csv(usage_id_0416, file = file.path(data_path, "usage_id_0416.xlsx"))
write.csv(usage_id_0416, file = file.path(data_path, "usage_id_0416.csv"))
View(usage_id_0416)
View(usage_unique)
sum(!is.na(usage_unique$village_id))
usage_id_0416 <
write.csv(usage_unique, file = file.path(data_path, "usage_unique_0416.csv"))
write.csv(usage_unique, file = file.path(data_path, "usage_unique_0416.csv"))
write_xlsx(usage_id_0416, path = file.path(data_path, "usage_id_0416.xlsx"))
write_xlsx(usage_noid_0416, path = file.path(data_path, "usage_noid_0416.xlsx"))
