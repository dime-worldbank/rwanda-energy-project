starify <- function(p) {
if (p < 0.001) return("***")
else if (p >= 0.001 & p < 0.01) return("**")
else if (p >= 0.01 & p < 0.05) return("*")
else if (p >= 0.05 & p < 0.1) return(".")
else return("")
}
results <- list()
for (outcome in outcomes) {
# summary stats
summ_stats <- data %>%
group_by(.data[[extract_var]]) %>%
summarise(
mean = mean(.data[[outcome]], na.rm = TRUE),
sd   = sd(.data[[outcome]], na.rm = TRUE),
n    = n(),
.groups = "drop"
)
# regression for difference
fml <- as.formula(paste0(outcome, " ~ ", rhs_string, " | ", fe_string, " | 0 | ", cluster_name))
reg <- felm(fml, data = data)
reg_summary <- summary(reg)
coef_row <- reg_summary$coefficients[extract_var, ]
diff_est <- coef_row["Estimate"]
diff_se  <- coef_row["Cluster s.e."]
p_value  <- coef_row["Pr(>|t|)"]
stars    <- starify(p_value)
results[[length(results) + 1]] <- tibble(
outcome = outcome,
control_mean = summ_stats$mean[summ_stats[[extract_var]] == 0],
control_sd   = summ_stats$sd[summ_stats[[extract_var]] == 0],
treated_mean = summ_stats$mean[summ_stats[[extract_var]] == 1],
treated_sd   = summ_stats$sd[summ_stats[[extract_var]] == 1],
diff_est = diff_est,
diff_se  = diff_se,
p_value = p_value,
stars = stars,
spec = if (is.null(fe)) "No FE" else if (length(fe) == 1) "Cell FE" else "Full FE"
)
}
bind_rows(results)
}
# ===============================================================
# 2. Run for each FE specification
# ===============================================================
bt_no_fe <- balance_table(
data = elec15_17_p %>% filter(year == 2014),
treatment_vars = c("elec15_17"),
cluster = sector_id,
fe = NULL
)
bt_cell_fe <- balance_table(
data = elec15_17_p %>% filter(year == 2014),
treatment_vars = c("elec15_17"),
cluster = sector_id,
fe = c("cell_id")
)
bt_all_fe <- balance_table(
data = elec15_17_p %>% filter(year == 2014),
treatment_vars = c("elec15_17", "log1_residential_consumer", "log1_non_residential_consumer"),
cluster = sector_id,
fe = c("cell_id", "cell_office", "health_center",
"primary_school", "secondary_school", "sector_district_office",
"industry", "market", "imidugudu")
)
combined <- bind_rows(bt_no_fe, bt_cell_fe, bt_all_fe)
# Control bar (only once)
control_df <- combined %>%
filter(spec == "No FE") %>%
select(outcome, control_mean, control_sd) %>%
mutate(
spec = "Never elec.",
group = "Control",
value = control_mean,
se = 1.96 * control_sd
)
# Treatment bars (Cell FE and All FE only)
treat_df <- combined %>%
filter(spec != "No FE") %>%
mutate(
spec = case_when(
spec == "Cell FE" ~ "Elec.'15-'17 \n (Cell FE)",
spec == "Full FE" ~ "Elec.'15-'17 \n (All controls)"
),
group = "Treatment",
value = control_mean + diff_est,
se = 1.96 * diff_se
) %>%
select(outcome, spec, group, value, se)
# Combine for plot
plot_df <- bind_rows(control_df, treat_df) %>%
mutate(
spec = factor(spec, levels = c("Never elec.", "Elec.'15-'17 \n (Cell FE)", "Elec.'15-'17 \n (All controls)")),
group = factor(group, levels = c("Control", "Treatment"))
)
# ===============================================================
# 3. Plot function
# ===============================================================
plot_outcome <- function(df, y_label) {
ggplot(df, aes(x = spec, y = value, fill = group)) +
geom_col(width = 0.5) +
geom_errorbar(
aes(ymin = value - se, ymax = value + se),
width = 0.2,
data = df %>% filter(group == "Treatment"),
color = "black"
) +
scale_fill_manual(values = c("Control" = "grey70", "Treatment" = "grey40")) +
labs(
x = "",
y = y_label,
fill = NULL
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_blank(),
legend.position = "none",
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
panel.grid.major.y = element_line(color = "gray80", linetype = "dashed"),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank()
)
}
# ===============================================================
# 4. Generate and save plots
# ===============================================================
p_est <- plot_outcome(
filter(plot_df, outcome == "num_establishment"),
"2014 Number of Establishments\n(Private Sector)"
)
p_emp <- plot_outcome(
filter(plot_df, outcome == "total_employee"),
"2014 Number of Employees\n(Private Sector)"
)
# Show plots
p_est
p_emp
# Combine for plot
plot_df <- bind_rows(control_df, treat_df) %>%
mutate(
spec = factor(spec, levels = c("Never elec.", "Elec.'15-'17 \n (All controls)",  "Elec.'15-'17 \n (Cell FE)",)),
group = factor(group, levels = c("Control", "Treatment"))
)
# Combine for plot
plot_df <- bind_rows(control_df, treat_df) %>%
mutate(
spec = factor(spec, levels = c("Never elec.", "Elec.'15-'17 \n (All controls)",  "Elec.'15-'17 \n (Cell FE)")),
group = factor(group, levels = c("Control", "Treatment"))
)
# ===============================================================
# 3. Plot function
# ===============================================================
plot_outcome <- function(df, y_label) {
ggplot(df, aes(x = spec, y = value, fill = group)) +
geom_col(width = 0.5) +
geom_errorbar(
aes(ymin = value - se, ymax = value + se),
width = 0.2,
data = df %>% filter(group == "Treatment"),
color = "black"
) +
scale_fill_manual(values = c("Control" = "grey70", "Treatment" = "grey40")) +
labs(
x = "",
y = y_label,
fill = NULL
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_blank(),
legend.position = "none",
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
panel.grid.major.y = element_line(color = "gray80", linetype = "dashed"),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank()
)
}
# ===============================================================
# 4. Generate and save plots
# ===============================================================
p_est <- plot_outcome(
filter(plot_df, outcome == "num_establishment"),
"2014 Number of Establishments\n(Private Sector)"
)
p_emp <- plot_outcome(
filter(plot_df, outcome == "total_employee"),
"2014 Number of Employees\n(Private Sector)"
)
# Show plots
p_est
p_emp
balance_table <- function(data, treatment_vars, cluster, fe = NULL,
outcomes = c("num_establishment", "total_employee"),
extract_var = "elec12_14") {
cluster_var <- enquo(cluster)
cluster_name <- quo_name(cluster_var)
rhs_string <- paste(treatment_vars, collapse = " + ")
fe_string  <- if (!is.null(fe)) paste(fe, collapse = " + ") else "0"
# helper function for significance stars
starify <- function(p) {
if (p < 0.001) return("***")
else if (p >= 0.001 & p < 0.01) return("**")
else if (p >= 0.01 & p < 0.05) return("*")
else if (p >= 0.05 & p < 0.1) return(".")
else return("")
}
results <- list()
for (outcome in outcomes) {
# summary stats
summ_stats <- data %>%
group_by(.data[[extract_var]]) %>%
summarise(
mean = mean(.data[[outcome]], na.rm = TRUE),
sd   = sd(.data[[outcome]], na.rm = TRUE),
n    = n(),
.groups = "drop"
)
# regression for difference
fml <- as.formula(paste0(outcome, " ~ ", rhs_string, " | ", fe_string, " | 0 | ", cluster_name))
reg <- felm(fml, data = data)
reg_summary <- summary(reg)
coef_row <- reg_summary$coefficients[extract_var, ]
diff_est <- coef_row["Estimate"]
diff_se  <- coef_row["Cluster s.e."]
p_value  <- coef_row["Pr(>|t|)"]
stars    <- starify(p_value)
results[[length(results) + 1]] <- tibble(
outcome = outcome,
control_mean = summ_stats$mean[summ_stats[[extract_var]] == 0],
control_sd   = summ_stats$sd[summ_stats[[extract_var]] == 0],
treated_mean = summ_stats$mean[summ_stats[[extract_var]] == 1],
treated_sd   = summ_stats$sd[summ_stats[[extract_var]] == 1],
diff_est = diff_est,
diff_se  = diff_se,
p_value = p_value,
stars = stars,
spec = if (is.null(fe)) "No FE" else if (length(fe) == 1) "Cell FE" else "Full FE"
)
}
bind_rows(results)
}
# ===============================================================
# 2. Run for each FE specification
# ===============================================================
bt_no_fe <- balance_table(
data = elec12_14_p %>% filter(year == 2011),
treatment_vars = c("elec12_14"),
cluster = sector_id,
fe = NULL
)
bt_cell_fe <- balance_table(
data = elec12_14_p %>% filter(year == 2011),
treatment_vars = c("elec12_14"),
cluster = sector_id,
fe = c("cell_id")
)
bt_all_fe <- balance_table(
data = elec12_14_p %>% filter(year == 2011),
treatment_vars = c("elec12_14", "log1_residential_consumer", "log1_non_residential_consumer"),
cluster = sector_id,
fe = c("cell_id", "cell_office", "health_center",
"primary_school", "secondary_school", "sector_district_office",
"industry", "market", "imidugudu")
)
combined <- bind_rows(bt_no_fe, bt_cell_fe, bt_all_fe)
# Control bar (only once)
control_df <- combined %>%
filter(spec == "No FE") %>%
select(outcome, control_mean, control_sd) %>%
mutate(
spec = "Never elec.",
group = "Control",
value = control_mean,
se = 1.96 * control_sd
)
# Treatment bars (Cell FE and All FE only)
treat_df <- combined %>%
filter(spec != "No FE") %>%
mutate(
spec = case_when(
spec == "Cell FE" ~ "Elec.'12–'14 \n (Cell FE)",
spec == "Full FE" ~ "Elec.'12–'14 \n (All controls)"
),
group = "Treatment",
value = control_mean + diff_est,
se = 1.96 * diff_se
) %>%
select(outcome, spec, group, value, se)
# Combine for plot
plot_df <- bind_rows(control_df, treat_df) %>%
mutate(
spec = factor(spec, levels = c("Never elec.",  "Elec.'12–'14 \n (All controls)", "Elec.'12–'14 \n (Cell FE)")),
group = factor(group, levels = c("Control", "Treatment"))
)
# ===============================================================
# 3. Plot function
# ===============================================================
plot_outcome <- function(df, y_label) {
ggplot(df, aes(x = spec, y = value, fill = group)) +
geom_col(width = 0.5) +
geom_errorbar(
aes(ymin = value - se, ymax = value + se),
width = 0.2,
data = df %>% filter(group == "Treatment"),
color = "black"
) +
scale_fill_manual(values = c("Control" = "grey70", "Treatment" = "grey40")) +
labs(
x = "",
y = y_label,
fill = NULL
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_blank(),
legend.position = "none",
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
panel.grid.major.y = element_line(color = "gray80", linetype = "dashed"),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank()
)
}
# ===============================================================
# 4. Generate and save plots
# ===============================================================
p_est <- plot_outcome(
filter(plot_df, outcome == "num_establishment"),
"2011 Number of Establishments\n(Private Sector)"
)
p_emp <- plot_outcome(
filter(plot_df, outcome == "total_employee"),
"2011 Number of Employees\n(Private Sector)"
)
# Show plots
p_est
p_emp
# Save plots
ggsave(
filename = file.path(output_path, "plot", "electrified_2012_2014_num_establishment.png"),
plot = p_est,
width = 8, height = 6, dpi = 300, scale = 0.6
)
ggsave(
filename = file.path(output_path, "plot", "electrified_2012_2014_total_employees.png"),
plot = p_emp,
width = 8, height = 6, dpi = 300, scale = 0.6
)
##Elec15-17------
balance_table <- function(data, treatment_vars, cluster, fe = NULL,
outcomes = c("num_establishment", "total_employee"),
extract_var = "elec15_17") {
cluster_var <- enquo(cluster)
cluster_name <- quo_name(cluster_var)
rhs_string <- paste(treatment_vars, collapse = " + ")
fe_string  <- if (!is.null(fe)) paste(fe, collapse = " + ") else "0"
# helper function for significance stars
starify <- function(p) {
if (p < 0.001) return("***")
else if (p >= 0.001 & p < 0.01) return("**")
else if (p >= 0.01 & p < 0.05) return("*")
else if (p >= 0.05 & p < 0.1) return(".")
else return("")
}
results <- list()
for (outcome in outcomes) {
# summary stats
summ_stats <- data %>%
group_by(.data[[extract_var]]) %>%
summarise(
mean = mean(.data[[outcome]], na.rm = TRUE),
sd   = sd(.data[[outcome]], na.rm = TRUE),
n    = n(),
.groups = "drop"
)
# regression for difference
fml <- as.formula(paste0(outcome, " ~ ", rhs_string, " | ", fe_string, " | 0 | ", cluster_name))
reg <- felm(fml, data = data)
reg_summary <- summary(reg)
coef_row <- reg_summary$coefficients[extract_var, ]
diff_est <- coef_row["Estimate"]
diff_se  <- coef_row["Cluster s.e."]
p_value  <- coef_row["Pr(>|t|)"]
stars    <- starify(p_value)
results[[length(results) + 1]] <- tibble(
outcome = outcome,
control_mean = summ_stats$mean[summ_stats[[extract_var]] == 0],
control_sd   = summ_stats$sd[summ_stats[[extract_var]] == 0],
treated_mean = summ_stats$mean[summ_stats[[extract_var]] == 1],
treated_sd   = summ_stats$sd[summ_stats[[extract_var]] == 1],
diff_est = diff_est,
diff_se  = diff_se,
p_value = p_value,
stars = stars,
spec = if (is.null(fe)) "No FE" else if (length(fe) == 1) "Cell FE" else "Full FE"
)
}
bind_rows(results)
}
# ===============================================================
# 2. Run for each FE specification
# ===============================================================
bt_no_fe <- balance_table(
data = elec15_17_p %>% filter(year == 2014),
treatment_vars = c("elec15_17"),
cluster = sector_id,
fe = NULL
)
bt_cell_fe <- balance_table(
data = elec15_17_p %>% filter(year == 2014),
treatment_vars = c("elec15_17"),
cluster = sector_id,
fe = c("cell_id")
)
bt_all_fe <- balance_table(
data = elec15_17_p %>% filter(year == 2014),
treatment_vars = c("elec15_17", "log1_residential_consumer", "log1_non_residential_consumer"),
cluster = sector_id,
fe = c("cell_id", "cell_office", "health_center",
"primary_school", "secondary_school", "sector_district_office",
"industry", "market", "imidugudu")
)
combined <- bind_rows(bt_no_fe, bt_cell_fe, bt_all_fe)
# Control bar (only once)
control_df <- combined %>%
filter(spec == "No FE") %>%
select(outcome, control_mean, control_sd) %>%
mutate(
spec = "Never elec.",
group = "Control",
value = control_mean,
se = 1.96 * control_sd
)
# Treatment bars (Cell FE and All FE only)
treat_df <- combined %>%
filter(spec != "No FE") %>%
mutate(
spec = case_when(
spec == "Cell FE" ~ "Elec.'15-'17 \n (Cell FE)",
spec == "Full FE" ~ "Elec.'15-'17 \n (All controls)"
),
group = "Treatment",
value = control_mean + diff_est,
se = 1.96 * diff_se
) %>%
select(outcome, spec, group, value, se)
# Combine for plot
plot_df <- bind_rows(control_df, treat_df) %>%
mutate(
spec = factor(spec, levels = c("Never elec.", "Elec.'15-'17 \n (All controls)",  "Elec.'15-'17 \n (Cell FE)")),
group = factor(group, levels = c("Control", "Treatment"))
)
# ===============================================================
# 3. Plot function
# ===============================================================
plot_outcome <- function(df, y_label) {
ggplot(df, aes(x = spec, y = value, fill = group)) +
geom_col(width = 0.5) +
geom_errorbar(
aes(ymin = value - se, ymax = value + se),
width = 0.2,
data = df %>% filter(group == "Treatment"),
color = "black"
) +
scale_fill_manual(values = c("Control" = "grey70", "Treatment" = "grey40")) +
labs(
x = "",
y = y_label,
fill = NULL
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_blank(),
legend.position = "none",
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
panel.grid.major.y = element_line(color = "gray80", linetype = "dashed"),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank()
)
}
# ===============================================================
# 4. Generate and save plots
# ===============================================================
p_est <- plot_outcome(
filter(plot_df, outcome == "num_establishment"),
"2014 Number of Establishments\n(Private Sector)"
)
p_emp <- plot_outcome(
filter(plot_df, outcome == "total_employee"),
"2014 Number of Employees\n(Private Sector)"
)
# Show plots
p_est
p_emp
# Save plots
ggsave(
filename = file.path(output_path, "plot", "electrified_2015_2017_num_establishment.png"),
plot = p_est,
width = 8, height = 6, dpi = 300, scale = 0.6
)
ggsave(
filename = file.path(output_path, "plot", "electrified_2015_2017_total_employees.png"),
plot = p_emp,
width = 8, height = 6, dpi = 300, scale = 0.6
)
