color = grid_factor
)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_color_manual(
values = c("1" = "darkorange", "0" = "steelblue"),
labels = c("Grid", "SHS")
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA)
)
# Step 3: Add marginal density plots
energy_demand_plot_marginal <- ggMarginal(
energy_demand_plot,
type = "density",
margins = "both",
groupColour = TRUE,   # Use grid_factor color for Y margin
groupFill = TRUE,     # Use grid_factor fill for Y margin
fill = NA,       # X margin in black
color = "black",      # X margin in black
alpha = 0.5           # Transparency for both
)
energy_demand_plot_marginal
# Base plot
energy_demand_plot <- ggplot(wtp_regress, aes(
x = log_demand,
y = log_wtp,
color = grid_factor
)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_color_manual(
values = c("1" = "darkorange", "0" = "steelblue"),
labels = c("Grid", "SHS")
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
axis.line.x = element_line(color = "black"),
legend.position = c(0.8, 0.4)
)
# Marginal plots (lines only, no fill shading)
energy_demand_plot_marginal <- ggMarginal(
energy_demand_plot,
data = wtp_regress,
type = "density",
margins = "both",
groupColour = TRUE,  # applies grid_factor colors to both axes
groupFill = FALSE,   # no fill (line only)
alpha = 1
)
energy_demand_plot_marginal
wtp_regress <- wtp_regress %>%
mutate(
log_demand = log(`energy demand`),
log_wtp = log(wtp),
grid_factor = factor(grid, levels = c(1, 0))  # Grid first
)
# Step 2: Base scatter + regression
scatter_plot <- ggplot(wtp_regress, aes(x = log_demand, y = log_wtp, color = grid_factor)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(
values = c("1" = "darkorange", "0" = "steelblue"),
labels = c("Grid", "SHS")
) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
theme_minimal(base_size = 13) +
theme(
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
legend.position = c(0.8, 0.4),
legend.title = element_blank()
)
# Step 3: X density (black line only)
x_density <- ggplot(wtp_regress, aes(x = log_demand)) +
geom_density(color = "black", fill = NA, linewidth = 0.8) +
theme_void() +
theme(
plot.margin = margin(0, 5, 0, 40)  # tighten margins
)
# Step 4: Y density (grouped color)
y_density <- ggplot(wtp_regress, aes(x = log_wtp, color = grid_factor)) +
geom_density(linewidth = 0.8) +
scale_color_manual(
values = c("1" = "darkorange", "0" = "steelblue")
) +
coord_flip() +
theme_void() +
theme(
legend.position = "none",
plot.margin = margin(0, 0, 10, 5)
)
# Step 5: Assemble with patchwork
final_plot <- x_density + plot_spacer() +
scatter_plot + y_density +
plot_layout(
widths = c(4, 1),
heights = c(1, 4)
)
ggsave(
file.path(output_path, "figures", "energy demand(marginal).png"),   # file name
plot = energy_demand_plot_marginal,                      # which plot to save
width = 8,                                         # width in inches
height = 6,                                        # height in inches
dpi = 300,                                         # high quality
scale = 0.7                                      # scale down by 60%
)
library(ggplot2)
library(patchwork)
install.packages("patchwork")
#Try-----
wtp_regress <- wtp_regress %>%
mutate(
log_demand = log(`energy demand`),
log_wtp = log(wtp),
grid_factor = factor(grid, levels = c(1, 0))  # Grid first
)
# Step 2: Create dummy variable to trick ggMarginal into coloring y-axis only
wtp_regress <- wtp_regress %>%
mutate(
dummy_group = factor("all")  # single level to force black x-axis
)
# Step 3: Main plot (colored by grid_factor)
energy_demand_plot <- ggplot(wtp_regress, aes(
x = log_demand,
y = log_wtp,
color = grid_factor
)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(
values = c("1" = "darkorange", "0" = "steelblue"),
labels = c("Grid", "SHS")
) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
axis.text = element_text(color = "black"),
panel.background = element_rect(fill = "white", color = NA),
plot.background = element_rect(fill = "white", color = NA),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
legend.position = c(0.8, 0.4)
)
# Step 4: Add marginal densities
energy_demand_plot_marginal <- ggMarginal(
energy_demand_plot,
type = "density",
margins = "both",
groupColour = TRUE,    # enables color by group (y-axis)
groupFill = FALSE,     # no fill shading
data = wtp_regress,
colour = "black",      # forces x-axis to be black (dummy group)
fill = NA,
alpha = 1
)
energy_demand_plot_marginal
energy_demand_plot
# Step 4: Add marginal densities
energy_demand_plot_marginal <- ggMarginal(
energy_demand_plot,
type = "density",
margins = "both",
groupColour = TRUE,    # enables color by group (y-axis)
groupFill = FALSE,     # no fill shading
data = wtp_regress,
colour = "black",      # forces x-axis to be black (dummy group)
fill = NA,
alpha = 1
)
energy_demand_plot_marginal
#Try-----
library(ggplot2)
library(patchwork)
library(dplyr)
# 1. Prep the data
wtp_regress <- wtp_regress %>%
mutate(
log_demand = log(`energy demand`),
log_wtp = log(wtp),
grid_factor = factor(grid, levels = c(1, 0), labels = c("Grid", "SHS"))
)
# 2. Main scatter plot
main_plot <- ggplot(wtp_regress, aes(x = log_demand, y = log_wtp, color = grid_factor)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
legend.position = c(0.8, 0.4),
panel.background = element_rect(fill = "white"),
axis.line = element_line(color = "black")
)
# 3. Top marginal plot (black density only for x-axis)
top_density <- ggplot(wtp_regress, aes(x = log_demand)) +
geom_density(color = "black", fill = NA, size = 0.7) +
theme_void() +
theme(plot.margin = margin(0, 5, 0, 35))
# 4. Right marginal plot (colored y-axis lines)
right_density <- ggplot(wtp_regress, aes(x = log_wtp, color = grid_factor)) +
geom_density(size = 0.7, fill = NA) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
coord_flip() +
theme_void() +
theme(plot.margin = margin(5, 0, 30, 0))
# 5. Assemble with patchwork
final_plot <- (
top_density + plot_spacer() +
main_plot + right_density
) +
plot_layout(
ncol = 2,
nrow = 2,
widths = c(4, 1),
heights = c(1, 4)
)
final_plot
# 1. Prep the data
wtp_regress <- wtp_regress %>%
mutate(
log_demand = log(`energy demand`),
log_wtp = log(wtp),
grid_factor = factor(grid, levels = c(1, 0), labels = c("Grid", "SHS"))
)
# Main scatter plot
main_plot <- ggplot(wtp_regress, aes(x = log_demand, y = log_wtp, color = grid_factor)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
legend.position = c(0.8, 0.4),
panel.background = element_rect(fill = "white"),
axis.line = element_line(color = "black")
)
# Top marginal (black x-axis density)
top_density <- ggplot(wtp_regress, aes(x = log_demand)) +
geom_density(color = "black", fill = NA, size = 0.7) +
theme_void() +
theme(plot.margin = margin(0, 5, 0, 35))
# Right marginal (colored y-axis density, no legend)
right_density <- ggplot(wtp_regress, aes(x = log_wtp, color = grid_factor)) +
geom_density(size = 0.7, fill = NA) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
coord_flip() +
theme_void() +
theme(
legend.position = "none",
plot.margin = margin(5, 0, 30, 0)
)
# Combine with patchwork
final_plot <- (
top_density + plot_spacer() +
main_plot + right_density
) +
plot_layout(
ncol = 2,
nrow = 2,
widths = c(4, 1),
heights = c(1, 4)
)
# Show final plot
final_plot
# Main scatter plot
main_plot <- ggplot(wtp_regress, aes(x = log_demand, y = log_wtp, color = grid_factor)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
legend.position = c(0.8, 0.4)
# panel.background = element_rect(fill = "white"),
# axis.line = element_line(color = "black")
)
# Top marginal (black x-axis density)
top_density <- ggplot(wtp_regress, aes(x = log_demand)) +
geom_density(color = "black", fill = NA, size = 0.7) +
theme_void()
# theme(plot.margin = margin(0, 5, 0, 35))
# Right marginal (colored y-axis density, no legend)
right_density <- ggplot(wtp_regress, aes(x = log_wtp, color = grid_factor)) +
geom_density(size = 0.7, fill = NA) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
coord_flip() +
theme_void() +
theme(
legend.position = "none"
# plot.margin = margin(5, 0, 30, 0)
)
# Combine with patchwork
final_plot <- (
top_density + plot_spacer() +
main_plot + right_density
) +
plot_layout(
ncol = 2,
nrow = 2,
widths = c(4, 1),
heights = c(1, 4)
)
# Show final plot
final_plot
# 1. Prep the data
wtp_regress <- wtp_regress %>%
mutate(
log_demand = log(`energy demand`),
log_wtp = log(wtp),
grid_factor = factor(grid, levels = c(1, 0), labels = c("Grid", "SHS"))
)
# Main scatter plot
main_plot <- ggplot(wtp_regress, aes(x = log_demand, y = log_wtp, color = grid_factor)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
legend.position = c(0.8, 0.4)
# panel.background = element_rect(fill = "white"),
# axis.line = element_line(color = "black")
)
# Top marginal (black x-axis density)
top_density <- ggplot(wtp_regress, aes(x = log_demand)) +
geom_density(color = "black", fill = NA, size = 0.7) +
theme_void()
# theme(plot.margin = margin(0, 5, 0, 35))
# Right marginal (colored y-axis density, no legend)
right_density <- ggplot(wtp_regress, aes(x = log_wtp, color = grid_factor)) +
geom_density(size = 0.7, fill = NA) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
coord_flip() +
theme_void() +
theme(
legend.position = "none"
# plot.margin = margin(5, 0, 30, 0)
)
# Combine with patchwork
energy_demand_plot_marginal <- (
top_density + plot_spacer() +
main_plot + right_density
) +
plot_layout(
ncol = 2,
nrow = 2,
widths = c(4, 1),
heights = c(1, 4)
)
# Show final plot
energy_demand_plot_marginal
library(ggExtra)
library(patchwork)
# 1. Prep the data
wtp_regress <- wtp_regress %>%
mutate(
log_demand = log(`energy demand`),
log_wtp = log(wtp),
grid_factor = factor(grid, levels = c(1, 0), labels = c("Grid", "SHS"))
)
# Main scatter plot
main_plot <- ggplot(wtp_regress, aes(x = log_demand, y = log_wtp, color = grid_factor)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
scale_x_continuous(
name = "Energy Demand (RwF/month)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
scale_y_continuous(
name = "Willingness to Pay (RwF)",
breaks = log(c(100, 1000, 10000, 100000)),
labels = c(100, 1000, 10000, 100000)
) +
guides(color = guide_legend(title = NULL)) +
theme_minimal(base_size = 13) +
theme(
legend.position = c(0.8, 0.4)
# panel.background = element_rect(fill = "white"),
# axis.line = element_line(color = "black")
)
# Top marginal (black x-axis density)
top_density <- ggplot(wtp_regress, aes(x = log_demand)) +
geom_density(color = "black", fill = NA, size = 0.7) +
theme_void()
# theme(plot.margin = margin(0, 5, 0, 35))
# Right marginal (colored y-axis density, no legend)
right_density <- ggplot(wtp_regress, aes(x = log_wtp, color = grid_factor)) +
geom_density(size = 0.7, fill = NA) +
scale_color_manual(values = c("Grid" = "darkorange", "SHS" = "steelblue")) +
coord_flip() +
theme_void() +
theme(
legend.position = "none"
# plot.margin = margin(5, 0, 30, 0)
)
# Combine with patchwork
energy_demand_plot_marginal <- (
top_density + plot_spacer() +
main_plot + right_density
) +
plot_layout(
ncol = 2,
nrow = 2,
widths = c(4, 1),
heights = c(1, 4)
)
# Show final plot
energy_demand_plot_marginal
ggsave(
file.path(output_path, "figures", "energy demand(marginal).png"),   # file name
plot = energy_demand_plot_marginal,                      # which plot to save
width = 8,                                         # width in inches
height = 6,                                        # height in inches
dpi = 300,                                         # high quality
scale = 0.7                                      # scale down by 60%
)
