path = file.path(data_path_1, "Updated scope villages& households",
"Deployment SCREENING  Final.xlsx"),
sheet = "Rustiro"
) %>% clean_names()
deployment_rulindo <- read_xlsx(
path = file.path(data_path_1, "Updated scope villages& households",
"Deployment SCREENING  Final.xlsx"),
sheet = "Rulindo "
) %>% clean_names()
deployment_rusizi <- read_xlsx(
path = file.path(data_path_1, "Updated scope villages& households",
"Deployment SCREENING  Final.xlsx"),
sheet = "Rusizi"
) %>% clean_names()
deployment <- rbind(deployment_karongi, deployment_rutsiro, deployment_rulindo, deployment_rusizi)
deployment <- deployment %>%
mutate(
across(
c(district, sector, cell, village),
~ str_to_title(.x)
)
) %>%
filter(!is.na(number_of_hh_surveyed > 0)) %>%
fill(everything(), .direction = "down")
View(deployment)
deployment <- deployment %>%
mutate(
across(
c(district, sector, cell, village),
~ str_to_title(.x)
)
) %>%
filter(!is.na(number_of_participants > 0)) %>%
fill(everything(), .direction = "down")
#Check deployment plan-----
complete  <- read_xlsx(path = file.path(data_path_1, "Updated scope villages& households","vulnerable households in sample villages.xlsx"))
comp_deploy <- complete %>%
select(
villageid_key,district, sector, cell, village, `Approached by Lattanzio`, `In Fully Completed village`
)
scope_village <- complete %>%
select(
villageid_key, district, sector, cell, village
) %>%
distinct(villageid_key, .keep_all = TRUE)
scope_village <- scope_village %>%
mutate(
across(
c(district, sector, cell, village),
~ str_to_title(.x)
))
deployment <- deployment %>%
mutate(
across(
c(district, sector, cell, village),
~ str_to_title(.x)
)
)
deployment <- left_join(deployment, scope_village, by = c("district","sector", "cell", "village"))
deployment_noid <- deployment %>%
filter(
is.na(villageid_key)
)
View(deployment_noid)
#join with complete list----
comp_deploy <- complete %>%
select(
villageid_key,district, sector, cell, village, `Approached by Lattanzio`, `In Fully Completed village`, `Dropped from scope due to 15kv`
)  %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
) %>%
group_by(
villageid_key, district, sector, cell, village
) %>%
summarise(
n = n()
) %>%
ungroup() %>%
mutate(
across(
c(district, sector, cell, village),
~ str_to_title(.x)
))
deploy_list <- complete %>%
select(
villageid_key,district, sector, cell, village, `Approached by Lattanzio`, `In Fully Completed village`, `Dropped from scope due to 15kv`
)  %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
) %>%
mutate(
across(
c(district, sector, cell, village),
~ str_to_title(.x)
)
)
deployment_join <- deployment %>%
select(villageid_key, hh_survey)
comp_deploy <- comp_deploy %>%
rename(
dime_hh_number = n,
lattanzio_hh_number = number_of_participants
)
deployment_join <- deployment %>%
select(villageid_key,number_of_participants)
comp_deploy <- left_join(comp_deploy, deployment_join, by = "villageid_key")
comp_deploy <- comp_deploy %>%
rename(
dime_hh_number = n,
lattanzio_hh_number = number_of_participants
)
comp_deploy_na <- comp_deploy %>%
filter(is.na(lattanzio_hh_number))
View(comp_deploy)
View(comp_deploy_na)
#Deploy anti match------
deployment <- read_xlsx(path = file.path(data_path_1, "Updated scope villages& households","deployment.xlsx"))
deployment <- deployment %>%
mutate(
across(
c(district, sector, cell, village),
str_to_title            # title-case every selected column
)
) %>%
mutate(
village = case_when(
village == "Kabyingo" ~ "Kabyigo",
village == "Muhondo"  ~ "Ruhondo",
village == "Rubugu"   ~ "Rubuye",
village == "Gashengeri" ~ "Gahengeri",
TRUE                  ~ village          # keep all other names unchanged
)
)
deployment <- left_join(deployment, scope_village, by = c("district","sector", "cell", "village"))
deployment <- deployment %>%
mutate(
villageid_key = ifelse(is.na(villageid_key), "31080104", villageid_key)
)
deployment_join <- deployment %>%
select(villageid_key, district, sector, cell, village, hh_survey)
complete_report_join <- complete %>%
mutate(
status = ifelse(`In Fully Completed village` == "Yes", "Completed Village",
ifelse(`Dropped from scope due to 15kv` == "Yes", "Dropped Village", "To be Surveyed"))
) %>%
select(villageid_key, status) %>%
distinct(villageid_key, .keep_all =TRUE)
complete_report_join_2 <- complete%>%
filter(
`Approached by Lattanzio` == "No" & `In Fully Completed village` == "No" & `Dropped from scope due to 15kv` == "No"
) %>%
group_by(villageid_key) %>%
summarise(
tobe_surveyed_hh = n()
)
complete_report_join <- left_join(complete_report_join, complete_report_join_2, by = "villageid_key")
deployment_report<- left_join(deployment, complete_report_join, by = c("villageid_key"))
deployment_report <- deployment_report %>%
distinct(villageid_key, .keep_all = TRUE)
deployment_report_anti <- left_join(complete_report_join_2,
deployment_join,
by = c("villageid_key"))
deployment_report_anti<- deployment_report_anti %>%
distinct(villageid_key, .keep_all = TRUE)
View(deployment_report)
is.na(tobe_surveyed_hh)
sum(is.na(deployment_report$tobe_surveyed_hh))
168-17
deployment_report$hh_survey == deployment_report$tobe_surveyed_hh
View(deployment_report_anti)
deployment_report_check <- deployment_report %>%
filter(!is.na(tobe_surveyed_hh)) %>%
mutate(
check = hh_survey - tobe_surveyed_hh
)
View(deployment_report_check)
deployment_report_check <- deployment_report %>%
filter(!is.na(tobe_surveyed_hh)) %>%
mutate(
check = hh_survey - tobe_surveyed_hh
) %>%
filter(
check != 0
) %>%
rename(
discrepency = check
)
write_xlsx(
deployment_report_check,
path = file.path(data_path_1, "Updated scope villages& households", "deployment_final_check.xlsx")
)
# Import Data ----
dropbox <- 'C:/Users/wb614406/Dropbox'
output_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/baseline analysis/output"
)
data_path_1 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data"
)
hfc_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/HFC/data"
)
data_path_2 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/Updated scope villages&households/EDCL"
)
data_path_2 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/Updated scope villages&households"
)
deployment_households <- read_xlsx(path = file.path(data_path_2, "Household and village list for deployment.xlsx"))
pacman::p_load(knitr, stargazer, tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr, RCT, purrr, lfe)
library(googlesheets4)
getwd()
.
# Import Data ----
dropbox <- 'C:/Users/wb614406/Dropbox'
output_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/baseline analysis/output"
)
data_path_1 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data"
)
hfc_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/HFC/data"
)
data_path_2 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/Updated scope villages&households"
)
#Read files------
deployment_households <- read_xlsx(path = file.path(data_path_2, "Household and village list for deployment.xlsx"))
data_path_2 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/Updated scope villages& households"
)
deployment_households <- read_xlsx(path = file.path(data_path_2, "Household and village list for deployment.xlsx"))
deployment_households <- read_xlsx(path = file.path(data_path_2, "Household and village list for deployment.xlsx"), sheet = "household list")
screening_survey <- read.csv(file.path(hfc_path, "REP_screening_WIDE.csv"))
View(screening_survey)
screening_survey <- screening_survey %>%
mutate(
across(everything(), ~ ifelse(.x == "", NA, .x))
)
screening_check <- screening_survey %>%
filter(!household_is %in% deployment_households$household_id)
screening_check <- screening_survey %>%
filter(!household_id %in% deployment_households$household_id)
View(deployment_households)
deployment_households <- read_xlsx(path = file.path(data_path_2, "Household and village list for deployment.xlsx"), sheet = "household list")
complete_report_join <- complete %>%
mutate(
status = ifelse(`In Fully Completed village` == "Yes", "Completed Village",
ifelse(`Dropped from scope due to 15kv` == "Yes", "Dropped Village", "To be Surveyed"))
)
View(complete_report_join_2)
complete  <- read_xlsx(path = file.path(data_path_1, "Updated scope villages& households","vulnerable households in sample villages.xlsx"))
complete_report_join <- complete %>%
mutate(
status = ifelse(`In Fully Completed village` == "Yes", "Completed Village",
ifelse(`Dropped from scope due to 15kv` == "Yes", "Dropped Village", "To be Surveyed"))
)
View(complete_report_join)
screening_check <- screening_survey %>%
filter(!household_id %in% deployment_households$household_id)
complete_report_join <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
)
screening_check <- screening_survey %>%
filter(!household_id %in% complete_report_join$household_id)
complete  <- read_xlsx(path = file.path(data_path_1, "Updated scope villages& households","vulnerable households in sample villages.xlsx"))
complete_report_join <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
)
View(screening_survey)
screening_check <- screening_survey %>%
filter(!hh_id %in% complete_report_join$household_id)
View(screening_check)
screening_check_village <- screening_check %>%
filter(village %in% complete_report_join$villageid_key) %>%
screening_check_village <- screening_check %>%
filter(village %in% complete_report_join$villageid_key)
screening_check_village <- screening_check %>%
filter(village %in% complete_report_join$villageid_key)
complete_report_village <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
) %>%
select(villageid_key, village, cell, sector, district, province) %>%
distinct(villageid_key, .keep_all = TRUE)
complete_report_village <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
) %>%
select(villageid_key, village, cell, sector, district) %>%
distinct(villageid_key, .keep_all = TRUE)
complete_report_join <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
)
screening_check <- screening_survey %>%
filter(hh_id %in% complete_report_join$household_id)
View(screening_check)
screening_check_village <- screening_survey %>%
filter(village %in% complete_report_join$villageid_key)
nrow(screening_survey)
screening_check <- screening_survey %>%
filter(
!village %in% complete_report_join$villageid_key |
!hh_id %in% complete_report_join$household_id
)
View(screening_check)
screening_in <- screening_survey %>%
filter(
village %in% complete_report_join$villageid_key &
hh_id %in% complete_report_join$household_id
)
109+26
sum(!is.na(screening_in$eligible))
49/109
write_xlsx(screening_check, path = file.path(data_path_2, "Screening survey not in scope.xlsx"))
write_xlsx(
list(
"Household_List" = complete_report_join,
"Village_List" = complete_report_village
),
path = file.path(data_path_2, "Household and village list for deployment.xlsx")
)
screening_check_village <- screening_survey %>%
filter(!village y%in% complete_report_village$villageid_key)
screening_check_village <- screening_survey %>%
filter(!village %in% complete_report_village$villageid_key)
View(screening_check_village)
scope_vilage <- read_xlsx(path = file.path(data_path_2, "scope_193_0807.xlsx"))
View(scope_village)
scope_village <- read_xlsx(path = file.path(data_path_2, "scope_193_0807.xlsx"))
screening_survey <- read.csv(file.path(hfc_path, "REP_screening_WIDE.csv"))
screening_survey <- screening_survey %>%
mutate(
across(everything(), ~ ifelse(.x == "", NA, .x))
) %>%
left_join(
scope_village,
by = c("village" = "villageid_key")
)
screening_check_village <- screening_survey %>%
filter(!village %in% complete_report_village$villageid_key)
screening_survey <- screening_survey %>%
mutate(
across(everything(), ~ ifelse(.x == "", NA, .x))
) %>%
left_join(
scope_village,
by = c("village" = "village_id")
)
screening_check_village <- screening_survey %>%
filter(!village %in% complete_report_village$villageid_key)
View(screening_check_village)
View(screening_check_village)
View(screening_survey)
scope_village <- scope_village %>%
mutate(
village_id = as.numeric(village_id)
) %>%
select(village_id, village, cell, sector, district)
scope_village <- scope_village %>%
mutate(
village_id = as.numeric(village_id)
) %>%
select(village_id, name, cell, sector, district)
screening_survey <- read.csv(file.path(hfc_path, "REP_screening_WIDE.csv"))
screening_survey <- screening_survey %>%
mutate(
across(everything(), ~ ifelse(.x == "", NA, .x))
) %>%
left_join(
scope_village,
by = c("village" = "village_id")
)
View(screening_survey)
complete  <- read_xlsx(path = file.path(data_path_1, "Updated scope villages& households","vulnerable households in sample villages.xlsx"))
complete_report_join <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
)
complete_report_village <- complete %>%
filter(
`In Fully Completed village` == "No" &`Approached by Lattanzio` == "No" & `Dropped from scope due to 15kv` == "No"
) %>%
select(villageid_key, village, cell, sector, district) %>%
distinct(villageid_key, .keep_all = TRUE)
write_xlsx(
list(
"Household_List" = complete_report_join,
"Village_List" = complete_report_village
),
path = file.path(data_path_2, "Household and village list for deployment.xlsx")
)
screening_check_village <- screening_survey %>%
filter(!village %in% complete_report_village$villageid_key)
View(screening_check_village)
screening_check <- screening_survey %>%
filter(
!village %in% complete_report_join$villageid_key |
!hh_id %in% complete_report_join$household_id
)
write_xlsx(screening_check, path = file.path(data_path_2, "Screening survey not in scope.xlsx"))
screening_in <- screening_survey %>%
filter(
village %in% complete_report_join$villageid_key &
hh_id %in% complete_report_join$household_id
)
sum(!is.na(screening_in$eligible))
49/109
nrow(rulindo_distinct)
pacman::p_load(knitr, stargazer, tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr, RCT, purrr, lfe)
library(googlesheets4)
getwd()
# Import Data ----
dropbox <- 'C:/Users/wb614406/Dropbox'
output_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/baseline analysis/output"
)
data_path_1 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data"
)
hfc_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/HFC/data"
)
data_path_2 <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/RCT_data/baseline/data/Updated scope villages& households"
)
#check rulindo 2
rulindo_site2 <- read_xlsx(path = file.path(data_path_2, "Rulindo_Site2.xlsx"), sheet = "in_scope")
rulindo_noscope <- read_xlsx(path = file.path(data_path_2, "Rulindo_Site2.xlsx"), sheet = "out_scope")
rulindo_list <- read_xlsx(path = file.path(data_path_2, "EDCL", "Readyboard by lot", "Lot_Rulindo.xlsx"),
sheet = "household list")
rulindo_site2 <- rulindo_site2 %>%
clean_names() %>%
mutate(
comments = "in_scope"
)
rulindo_noscope <- rulindo_noscope %>%
clean_names() %>%
mutate(
comments = "out_scope"
)
rulindo_scope <- rbind(rulindo_site2, rulindo_noscope)
rulindo_distinct <- rulindo_scope %>%
distinct(nid, first_name, last_name, villageid_key, .keep_all = TRUE) %>%
mutate(
check= paste0(nid, first_name, last_name)
)
rulindo_6 <- rulindo_list %>%
filter(
villageid_key %in% rulindo_distinct$villageid_key
) %>%
distinct(nid, first_name, last_name, villageid_key, .keep_all = TRUE) %>%
mutate(
check = paste0(nid, first_name, last_name)
)
#
#
# rulindo_check0 <- rulindo_6 %>%
#   filter(
#     !nid %in% rulindo_distinct$nid
#   )
#
#
# rulindo_check <- rulindo_distinct %>%
#   filter(
#     !nid %in% rulindo_6$nid
#   )
complete  <- read_xlsx(path = file.path(data_path_2, "vulnerable households in sample villages.xlsx"))
rulindo_complete <- complete %>%
filter(
villageid_key %in% rulindo_distinct$villageid_key
) %>%
filter(`Completed by Lattanzio`== "Yes")
rulindo_scope_1 <- rulindo_scope %>%
filter(
comments == "in_scope"
)
nrow(rulindo_distinct)
nrow(rulindo_scope_1)
nrow(rulindo_list)
rulindo_6 <- rulindo_list %>%
filter(
villageid_key %in% rulindo_distinct$villageid_key
) %>%
distinct(nid, first_name, last_name, villageid_key, .keep_all = TRUE) %>%
mutate(
check = paste0(nid, first_name, last_name)
)
nrow(rulindo_6)
rulindo_check <- rulindo_complete %>%
filter(
nid %in% rulindo_scope_1$nid
)
