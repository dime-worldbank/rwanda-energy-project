scope_path <- file.path(
  DROPBOX,
  "Rwanda Energy/EAQIP/datawork/RCT_data",
  "baseline/data/Updated scope villages& households"
)

karongi <- file.path("C:\Users\wb614406\Downloads\Lot_Karongi.xlsx")


lot_rutsiro_village <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "Lot_Rutsiro.xlsx"), sheet = "village list")

lot_rutsiro_household <- read_xlsx(path = file.path(scope_path,"EDCL",  "Readyboard by lot", "Lot_Rutsiro.xlsx"), sheet = "household list")


new_rutsiro_village <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "New_Lot_Rutsiro.xlsx"), sheet = "village list")

new_rutsiro_household <- read_xlsx(path = file.path(scope_path,"EDCL",  "Readyboard by lot", "New_Lot_Rutsiro.xlsx"), sheet = "household list")


identical(lot_rutsiro_village, new_rutsiro_village)
identical(lot_rutsiro_household, new_rutsiro_household)


library(readxl)   # for read_excel()
library(purrr)    # for map()/imap()
library(dplyr)    # for bind_rows(), if you want to merge later


rusizi_lot1 <- read_xlsx(path = file.path(scope_path, "Rusizi_check_250428.xlsx"), sheet = "lot 1")

rusizi_readyboard1 <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "Lot_Rusizi-1.xlsx"), sheet = "village list")

rusizi_lot2 <- read_xlsx(path = file.path(scope_path, "Rusizi_check_250428.xlsx"), sheet = "lot 2")

rusizi_readyboard2 <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "Lot_Rusizi-2.xlsx"), sheet = "village list")

rusizi_lot1 <- rusizi_lot1 %>% 
  mutate(
    sector = str_to_title(sector),
    cell = str_to_title(cell),
    name = str_to_title(village)
  ) %>% 
  select(sector, cell, name) %>% 
  filter(!is.na(sector))

rusizi_lot2 <- rusizi_lot2 %>% 
  mutate(
    sector = str_to_title(sector),
    cell = str_to_title(cell)
  ) %>% 
  mutate(
    name = NA
  ) %>% 
  select(sector, cell, name)

rusizi_village <- rbind(rusizi_lot1, rusizi_lot2)

rusizi_readyboard <- rbind(rusizi_readyboard1, rusizi_readyboard2)

rusizi_village <- rusizi_village %>% 
  mutate(
    district = "Rusizi"
  )


rusizi_village <- left_join(rusizi_village, rusizi_readyboard, by = c("district" , "sector", "cell", "name"))

rusizi_village <- rusizi_village %>% 
  filter(!is.na(province))
write_xlsx(rusizi_village, path = file.path(scope_path, "rusizi connection check.xlsx"))

#ID number match-----

# 1. Folder path  (use / or \\ on Windows)
folder <- "C:/Users/wb614406/Downloads/LOT 01"

# 2. List every .xls or .xlsx file in that folder
excel_files <- list.files(
  path       = folder,
  pattern    = "\\.xlsx?$",   # matches .xls and .xlsx
  full.names = TRUE
)

# 3. Read each workbook; store in a named list
all_books <- purrr::imap(excel_files, ~ readxl::read_excel(.x) )
# names(all_books) are the file names
names(all_books) <- basename(excel_files)

# optional: If every workbook has the same columns 
#           and you just want one big data-frame:
combined_lot1 <- bind_rows(all_books, .id = "source_file")


id_lot1 <- combined_lot1 %>% 
  select(...5) %>%
  mutate(id = ...5) %>% 
  filter(str_detect(id, "^\\d+$"))  %>% 
  select(id)


#lot2------


# 2. Folder path  (use / or \\ on Windows)
folder <- "C:/Users/wb614406/Downloads/Lot 02"

# 2. List every .xls or .xlsx file in that folder
excel_files <- list.files(
  path       = folder,
  pattern    = "\\.xlsx?$",   # matches .xls and .xlsx
  full.names = TRUE
)

# 3. Read each workbook; store in a named list
all_books <- purrr::imap(excel_files, ~ readxl::read_excel(.x) )
# names(all_books) are the file names
names(all_books) <- basename(excel_files)

# optional: If every workbook has the same columns 
#           and you just want one big data-frame:
combined_lot2 <- bind_rows(all_books, .id = "source_file")


id_lot2 <- combined_lot2 %>% 
  select(...11) %>%
  mutate(id = ...11) %>% 
  filter(str_detect(id, "^\\d+$"))    %>% 
  select(id)

id <- rbind(id_lot1, id_lot2)


rusizi_household1 <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "Lot_Rusizi-1.xlsx"), sheet = "household list")

rusizi_household2 <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "Lot_Rusizi-2.xlsx"), sheet = "household list")


rusizi_household <- rbind(rusizi_household1, rusizi_household2)

id <- left_join(id, rusizi_household, by = c("id" = "nid"))

id_check <- id %>% 
  filter(!is.na(first_name))


write_xlsx(id_check,  path = file.path(scope_path, "rusizi connection check_id.xlsx"))



#Rulindo_2 villages----
rulindo_status1 <- read_xlsx(path = file.path(scope_path,"Rulindo_readyboard_status.xlsx"), sheet = "readyboard")
rulindo_status2 <- read_xlsx(path = file.path(scope_path,"Rulindo_readyboard_status.xlsx"), sheet = "non_readyboard")

rulindo_readyboard <- read_xlsx(path = file.path(scope_path, "EDCL", "Readyboard by lot", "Lot_Rulindo.xlsx"), sheet = "household list")

rulindo_2 <- rulindo_readyboard %>% 
  filter(
    villageid_key %in% rulindo_status1$villageid_key
  )

rulindo_status1 <- rulindo_status1 %>% 
  mutate(
    status = "readyboard"
  )

rulindo_status2 <- rulindo_status2 %>% 
  mutate(
    status = "non_readyboard"
  )

rulindo_status <- rbind(rulindo_status1, rulindo_status2)

rulindo_check <- rulindo_status1 %>% 
  filter(!nid %in% rulindo_2$nid)



















