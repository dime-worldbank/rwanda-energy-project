filter(meter_percent < 0.3 & ubudehe_1 >= 20)
table(three_scope_2402.2$status)
three_scope_2402.2 %>%
filter(status == "newly") %>%
group_by(district) %>%
summarise(
village_n = n(),
ubudehe_1 = village_n * 20
)
write_xlsx(four_district_2492, path = file.path(
DROPBOX,"Rwanda Energy/datawork/RCT_data","baseline/data/data/four_district_2402.xlsx" ))
write_xlsx(four_district_2402, path = file.path(
DROPBOX,"Rwanda Energy/datawork/RCT_data","baseline/data/data/four_district_2402.xlsx" ))
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr)
getwd()
#Dropbox----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
#Method One----
path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data/four_district_2402.xlsx"
)
#read file----
four_district_2402 <- read_xlsx(path)
four_district_2402.1 <- four_district_2402 %>%
mutate(any_offgrid = case_when(
et_sum != 0 | priority_0 == 0 ~ "partial",
.default = "newly"
))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
any_grid = case_when(
grid_status %in% c("newly") & nep_revision%in% c("GE", "Fill In")  ~ "newly",
.default = "partial"
)
)
four_district_2402.1 <- four_district_2402.1  %>%
mutate(status = case_when(
any_grid == "newly" & any_offgrid == "newly" ~ "newly",
.default = "partial"
))
table(four_district_2402.1$scope_2402)
table(four_district_2402.1$scope_2401)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_percent = round(meter_eucl/total_hh, 2))
three_scope_2402.1 <- four_district_2402.1 %>%
filter(district %in% c("Karongi", "Rulindo", "Rutsiro") & scope_2402 == 1)
table(three_scope_2402.1$status)
three_scope_2402.2 <- three_scope_2402.1 %>%
filter(meter_percent < 0.3 & ubudehe_1 >= 20)
table(three_scope_2402.2$status)
three_scope_2402.2 %>%
filter(status == "newly") %>%
group_by(district) %>%
summarise(
village_n = n(),
ubudehe_1 = village_n * 20
)
#check rutsiro-----
rutsiro_scope_2402 <- three_scope_2402.1 %>%
filter(district %in% c("Rutsiro"))
View(rutsiro_scope)
View(rutsiro_scope_2402)
four_district_2402.1  <- four_district_2402.1 %>%
mutate(
status = ifelse(meter_percent >= 0.3, "partial", status)
)
three_scope_2402.1 <- four_district_2402.1 %>%
filter(district %in% c("Karongi", "Rulindo", "Rutsiro") & scope_2402 == 1)
table(three_scope_2402.1$status)
three_scope_2402.2 <- three_scope_2402.1 %>%
filter(meter_percent < 0.3 & ubudehe_1 >= 20)
table(three_scope_2402.2$status)
three_scope_2402.1 <- four_district_2402.1 %>%
filter(district %in% c("Karongi", "Rulindo", "Rutsiro") & scope_2402 == 1)
table(three_scope_2402.1$status)
View(three_scope_2402.1)
View(three_scope_2402.2)
#"newly" is in the randomization scope, "partial" is not
four_district_2402.1 <- four_district_2402 %>%
mutate(any_offgrid = case_when(
et_sum != 0 | priority_0 == 0 ~ "partial",
.default = "newly"
))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
any_grid = case_when(
grid_status %in% c("newly") & nep_revision%in% c("GE", "Fill In")  ~ "newly",
.default = "partial"
)
)
four_district_2402.1 <- four_district_2402.1  %>%
mutate(status = case_when(
any_grid == "newly" & any_offgrid == "newly" ~ "newly",
.default = "partial"
))
four_district_2402.1  <- four_district_2402.1 %>%
mutate(
status = ifelse(ubudehe_1 <20, "partial", status)
)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_percent = round(meter_eucl/total_hh, 2))
table(four_district_2402.1$status)
four_district_2402.2  <- four_district_2402.1 %>%
mutate(
status = ifelse(meter_percent >= 0.3, "partial", status)
)
table(four_district_2402.2$status)
three_scope_2402.1 <- four_district_2402.1 %>%
filter(district %in% c("Karongi", "Rulindo", "Rutsiro") & scope_2402 == 1)
table(three_scope_2402.1$status)
three_scope_2402.1 <- four_district_2402.2 %>%
filter(district %in% c("Karongi", "Rulindo", "Rutsiro") & scope_2402 == 1)
table(three_scope_2402.1$status)
three_scope_2402.2 <- three_scope_2402.1 %>%
filter(meter_percent < 0.3 & ubudehe_1 >= 20)
table(three_scope_2402.2$status)
table(three_scope_2402.1$status)
three_scope_rand <- three_scope_2402.1 %>%
mutate(strata_randomization = paste(lot, "-", status_cutoff))
three_scope_rand <- three_scope_2402.1 %>%
mutate(strata_randomization = paste(lot, "-", status))
table(three_scope_rand$strata_randomization)
###Newly----
threescope_newly <- three_scope%>%
filter(status == "newly")
table(threescope_newly$strata_randomization)
###Newly----
threescope_newly <- three_scope_rand%>%
filter(status == "newly")
table(threescope_newly$strata_randomization)
View(threescope_newly)
set.seed(938485)
newly_treatment <- block_ra(
blocks = threescope_newly$strata_randomization,
num_arms = 4,
prob_each = c(0.25, 0.25, 0.25, 0.25)
)
threescope_newly$treatment <- newly_treatment
newly_count <- threescope_newly %>%
group_by(strata_randomization) %>%
summarise(
village_number = n(),
control_villages = sum(ifelse(treatment == "T1", 1, 0)),
readyboard_villages = sum(ifelse(treatment == "T2", 1, 0)),
ubudehe_1 = sum(ifelse(treatment == "T2", ubudehe_1, 0)),
offgrid_villages = sum(ifelse(treatment == "T3", 1, 0)),
tbt_villages = sum(ifelse(treatment == "T4", 1, 0))
)
View(newly_count)
######partial randomization----
threescope_partial <- three_scope_rand %>%
filter(status_cutoff == "partial")
######partial randomization----
threescope_partial <- three_scope_rand %>%
filter(status == "partial")
partial_treatment <- block_ra(
blocks = threescope_partial$strata_randomization,
num_arms = 2,
prob_each = c(0.5, 0.5)
)
threescope_partial$treatment <- partial_treatment
partial_count <- threescope_partial %>%
group_by(strata_randomization) %>%
summarise(
village_number = n(),
ubudehe_1 = sum(ifelse(treatment == "T2", ubudehe_1, 0)),
control_villages = sum(ifelse(treatment == "T1", 1, 0)),
readyboard_villages = sum(ifelse(treatment == "T2", 1, 0)),
)
View(partial_count)
View(threescope_partial)
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr)
getwd()
#Dropbox----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
#Method One----
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data/four_district_2402.xlsx"
)
#Method One----
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data"
)
rusizi_meter <- st_read(dsn = file.path(data_path, "Rusizi Customer_Data_Commercial_QGIS.qgz"))
rusizi_meter <- st_read(dsn = file.path(data_path, "Rusizi Customer_Data_Commercial_QGIS.qgz"))
rusizi_meter <- st_read(dsn = file.path(data_path, "eucl meter", "rusizi_meter.shp"))
View(four_district_2402)
View(four_district_2402.2)
#Read the rusizi meter data
four_district_2402 <- read_xlsx(path = file.path(data_path, "four_district_2402.xlsx"))
View(rusizi_meter)
rusizi_meter <- rusizi_meter %>%
st_drop_geometry() %>%
group_by(Village_ID) %>%
summarise(rusizi_meter = n())
four_district_2402 <- left_join(four_district_2402, rusizi_meter, by = c("village_id" = "Village_ID"))
four_district_2402 <- four_district_2402 %>%
mutate(meter_eucl = ifelse(!is.na(rusizi_meter), rusizi_meter, meter_eucl))
#Read the rusizi meter data
four_district_2402 <- read_xlsx(path = file.path(data_path, "four_district_2402.xlsx"))
four_district_2402 <- left_join(four_district_2402, rusizi_meter, by = c("village_id" = "Village_ID"))
#Read the rusizi meter data
four_district_2402 <- read_xlsx(path = file.path(data_path, "four_district_2402.xlsx"))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_eucl = ifelse(district %in% c("Rusizi"), rusizi_meter, meter_eucl))
View(four_district_2402.1)
View(four_district_2402.1)
View(four_district_2402.1)
four_district_2402.1 <- left_join(four_district_2402, rusizi_meter, by = c("village_id" = "Village_ID"))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_eucl = ifelse(district %in% c("Rusizi"), rusizi_meter, meter_eucl))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_eucl = ifelse(is.na(meter_eucl), 0, meter_eucl)) %>%
select(-rusizi_meter)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(scope_2402 = ifelse(is.na(scope_2402), 0, scope_2402))
write_xlsx(four_district_2402.1, path = file.path(data_file))
write_xlsx(four_district_2402.1, path = file.path(data_path))
write_xlsx(four_district_2402.1, path = file.path(data_path, "four_district_2402.xlsx"))
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr)
getwd()
#Dropbox----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
#Method One----
path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data/four_district_2402.xlsx"
)
#read file----
four_district_2402 <- read_xlsx(path)
View(four_district_2402)
source("C:/Users/wb614406/github/rwanda-energy-project/RCT_data/baseline/scripts/Rusizi meter.R")
four_district_2402.1 <- four_district_2402 %>%
mutate(any_offgrid = case_when(
et_sum != 0 | priority_0 == 0 ~ "partial",
.default = "newly"
))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
any_grid = case_when(
grid_status %in% c("newly") & nep_revision%in% c("GE", "Fill In")  ~ "newly",
.default = "partial"
)
)
four_district_2402.1 <- four_district_2402.1  %>%
mutate(status = case_when(
any_grid == "newly" & any_offgrid == "newly" ~ "newly",
.default = "partial"
))
table(four_district_2402.1$scope_2401)
four_district_2402.1  <- four_district_2402.1 %>%
mutate(
status = ifelse(ubudehe_1 <20, "partial", status)
)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_percent = round(meter_eucl/total_hh, 2))
four_scope_2402.1 <- four_district_2402.1 %>%
filter( scope_2402 == 1)
table(four_scope_2402.1$status)
four_scope_2402.2 <- four_scope_2402.1 %>%
filter(meter_percent < 0.3 & ubudehe_1 >= 20)
table(four_scope_2402.2$status)
four_scope_2402.2 %>%
filter(status == "newly") %>%
group_by(district) %>%
summarise(
village_n = n(),
ubudehe_1 = village_n * 20
)
write_xlsx(four_district_2402.1, path = file.path(data_path, "four_district_2402.xlsx"))
write_xlsx(four_district_2402.1, path = file.path(data_path, "four_district_2402.xlsx"))
mde(142, 2840, 1, 1)
mde(142, 2840, 21.83, 10.83)
mde(142, 2840, 2.75, 2.64)
mde(142, 2840, 16.31, 7.9)
mde(210, 4200, 1, 1)
mde(210, 4200, 21.83, 10.83)
rutsiro_villages <- rwa_villages %>%
filter(District %in% c("Rutsiro"))
base_rutsiro <- ggplot(data = rutsiro_villages)
base_rutsiro
View(rwa_villages)
base_rutsiro <- ggplot() + geom_sf(data = rutsiro_villages)
base_rutsiro
rutsiro_villages <- st_make_valid(rutsiro_villages)
base_rutsiro <- ggplot() +
geom_sf(data = rutsiro_villages)
base_rutsiro <- ggplot() +
geom_sf(data = rutsiro_villages, fill = NA)
base_rutsiro
rusizi_meters_plot <- base_rusizi +
geom_sf(data = rusizi_lv, aes(color = "blue"))
rutsiro <- base_rutsiro +
geom_sf(data = rusizi_lv, aes(color = "blue"))
rutsiro <- base_rutsiro +
geom_sf(data = rutsiro_lv, aes(color = "blue"))
rutisro
rutsiro
mde(210, 4200, 2.75, 2.64)
mde(210, 4200, 16.31, 7.9)
source("C:/Users/wb614406/github/rwanda-energy-project/RCT_data/baseline/scripts/Rusizi meter.R")
#Method One----
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data"
)
##############
#Author: Xiaoming Zhang
#Date: 2.28.2024
#Purpose: join Rutsiro new scope
#############
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr)
getwd()
#Dropbox path----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data"
)
rwa_villages <- st_read(dsn = file.path(data_path, "rwa_villages", "Village_area.shp"))
rwa_villages <- st_make_valid(rwa_villages)
###Surveyed----
karongi_customer <- st_read(dsn = here(data_path, "Karongi Surveyed 0116", "Surveyed_Customers.shp"))
rulindo_customer <- st_read(dsn = here(data_path, "Rulindo Surveyed 0116", "Surveyed_Customers.shp"))
rutsiro_customer <- st_read(dsn = here(data_path, "Rutsiro Surveyed 0116", "Surveyed_Customers.shp"))
rulindo_customer <- st_transform(rulindo_customer, crs =  st_crs(rwa_villages))
karongi_customer <- st_transform(karongi_customer, crs =  st_crs(rwa_villages))
rutsiro_customer <- st_transform(rutsiro_customer, crs =  st_crs(rwa_villages))
four_district_2402 <- read_xlsx(path = file.path(data_path, "four_district_2402.xlsx"))
View(karongi_customer)
karongi_customer <- st_intersection(karongi_customer, rwa_villages)
rulindo_customer <- st_intersection(rulindo_customer, rwa_villages)
rutsiro_customer <- st_intersection(rutsiro_customer, rwa_villages)
karongi_customer.1 <- karongi_customer %>%
group_by(Village_ID) %>%
sum(customer = n())
karongi_customer.1 <- karongi_customer %>%
group_by(Village_ID) %>%
summarise(customer = n())
View(karongi_customer.1)
karongi_customer.1 <- karongi_customer %>%
group_by(Village_ID) %>%
summarise(customer = n()) %>%
st_drop_geometry()
rulindo_customer.1 <- rulindo_customer %>%
group_by(Village_ID) %>%
summarise(customer = n()) %>%
st_drop_geometry()
rutsiro_customer.1 <- rutsiro_customer %>%
group_by(Village_ID) %>%
summarise(customer = n()) %>%
st_drop_geometry()
karongi_customer.1 <- karongi_customer %>%
group_by(Village_ID) %>%
summarise(customer = n()) %>%
st_drop_geometry() %>%
select(Village_ID, customer)
rulindo_customer.1 <- rulindo_customer %>%
group_by(Village_ID) %>%
summarise(customer = n()) %>%
st_drop_geometry() %>%
select(Village_ID, customer)
rutsiro_customer.1 <- rutsiro_customer %>%
group_by(Village_ID) %>%
summarise(customer = n()) %>%
st_drop_geometry() %>%
select(Village_ID, customer)
customer <- bind_rows(karongi_customer.1, rulindo_customer.1, rutsiro_customer.1)
View(customer)
four_district_2402.1  <- left_join(four_district_2402.1 , customer, by = c("village_id" = "Village_ID"))
four_district_2402.1  <- left_join(four_district_2402 , customer, by = c("village_id" = "Village_ID"))
View(four_district_2401.1)
View(four_district_2402.2)
View(four_district_2402.1)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(customer = ifelse(is.na(customer),0, customer))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(any_offgrid = case_when(
et_sum != 0 | priority_0 == 0 ~ "partial",
.default = "newly"
))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
any_grid = case_when(
grid_status %in% c("newly") & nep_revision%in% c("GE", "Fill In")  ~ "newly",
.default = "partial"
)
)
four_district_2402.1 <- four_district_2402.1  %>%
mutate(status = case_when(
any_grid == "newly" & any_offgrid == "newly" ~ "newly",
.default = "partial"
))
table(four_district_2402.1$scope_2401)
four_district_2402.1  <- four_district_2402.1 %>%
mutate(
status = ifelse(ubudehe_1 <20, "partial", status)
)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_percent = round(meter_eucl/total_hh, 2))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
status = ifelse(meter_percent >= 0.3 , "partial", status)
)
write_xlsx(four_district_2402.1, path = file.path(data_path, "four_district_2402.xlsx"))
four_scope_2402 <- four_district_2402.1 %>%
filter( scope_2402 == 1)
table(four_scope_2402$status)
three_scope_newly <- four_scope_2402 %>%
filter(district %in% c("Karongi", "Rutsiro", "Rulindo") & status == "newly")
ts_cus0 <- three_scope_newly %>%
filter(customer !=0)
ts_cus5 <- three_scope_newly %>%
filter(customer > 5)
ts_cus10 <- three_scope_newly %>%
filter(customer > 10)
ts_cus0 %>%
group_by(district) %>%
summarise(n = n())
ts_cus5 %>%
group_by(district) %>%
summarise(n = n())
ts_cus10 %>%
group_by(district) %>%
summarise(n = n())
View(three_scope_rand)
View(three_scope_newly)
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr)
getwd()
#Dropbox----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
#Method One----
path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data/four_district_2401.xlsx"
)
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data"
)
four_district_2401 <- read_xlsx(path = file.path(data_path, "four_district_2402.xlsx"))
four_district_2402 <- read_xlsx(path = file.path(data_path, "four_district_2402.xlsx"))
four_district_2402.1 <- four_district_2402 %>%
mutate(any_offgrid = case_when(
et_sum != 0 | priority_0 == 0 ~ "partial",
.default = "newly"
))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
any_grid = case_when(
grid_status %in% c("newly") & nep_revision%in% c("GE", "Fill In")  ~ "newly",
.default = "partial"
)
)
four_district_2402.1 <- four_district_2402.1  %>%
mutate(status = case_when(
any_grid == "newly" & any_offgrid == "newly" ~ "newly",
.default = "partial"
))
table(four_district_2402.1$scope_2401)
four_district_2402.1  <- four_district_2402.1 %>%
mutate(
status = ifelse(ubudehe_1 <20, "partial", status)
)
four_district_2402.1 <- four_district_2402.1 %>%
mutate(meter_percent = round(meter_eucl/total_hh, 2))
four_district_2402.1 <- four_district_2402.1 %>%
mutate(
status = ifelse(meter_percent >= 0.3 , "partial", status)
)
four_district_scope <- four_district_2402 %>%
filter(customer >= 20)
four_district_2402 %>%
filter( scope_2402 == 1) %>%
table(four_scope_2402.1$status)
four_district_2402 %>%
filter( scope_2402 == 1 & status == "newly") %>%
group_by(district) %>%
summarise( n = n())
four_district_2402 %>%
filter(customer >= 20 & status == "newly") %>%
group_by(district) %>%
summarise( n = n())
four_district_2402 %>%
filter(customer == 0 & scope_2402 == 1)
four_district_2402 %>%
filter(customer == 0 & scope_2402 == 1 & district %in% c("Karongi", "Rutsiro", "Rulindo"))
four_district_2402 %>%
filter(customer >0 & scope_2402 == 0 & district %in% c("Karongi", "Rutsiro", "Rulindo"))
four_district_2402 %>%
filter(customer > 20 & scope_2402 == 0 & district %in% c("Karongi", "Rutsiro", "Rulindo"))
