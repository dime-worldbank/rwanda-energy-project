geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 6) +  # Increase data labels font size
labs(
title = "Surveyed customers/Number of households",
x = "Fraction Label",
y = "Frequency"
) +
scale_x_discrete(labels = c("0-0.25", "0.25-0.50", "0.50-0.75", "0.75-1")) +  # Adjust x-axis labels if needed
theme_minimal() +
theme(
axis.title = element_text(size = 12),  # Increase axis labels font size
axis.text = element_text(size = 10),   # Increase axis ticks font size
plot.title = element_text(size = 14)   # Increase plot title font size
)
p1
p1 <- ggplot(customer_check, aes(x = factor(fraction_label))) +
geom_bar(fill = "lightblue", color = "black") +
geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 5) +  # Increase data labels font size
labs(
title = "Surveyed customers/Number of households",
x = "Fraction Label",
y = "Frequency"
) +
scale_x_discrete(labels = c("0-0.25", "0.25-0.50", "0.50-0.75", "0.75-1")) +  # Adjust x-axis labels if needed
theme_minimal() +
theme(
axis.title = element_text(size = 16),  # Increase axis labels font size
axis.text = element_text(size = 16),   # Increase axis ticks font size
plot.title = element_text(size = 16)   # Increase plot title font size
)
p1
p1 <- ggplot(customer_check, aes(x = factor(fraction_label))) +
geom_bar(fill = "lightblue", color = "black") +
geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 5) +  # Increase data labels font size
labs(
title = "Surveyed customers/Number of households",
x = "Fraction Label",
y = "Frequency"
) +
scale_x_discrete(labels = c("0-0.25", "0.25-0.50", "0.50-0.75", "0.75-1")) +  # Adjust x-axis labels if needed
theme_minimal() +
theme(
axis.title = element_text(size = 20),  # Increase axis labels font size
axis.text = element_text(size = 20),   # Increase axis ticks font size
plot.title = element_text(size = 20)   # Increase plot title font size
)
p1
p1 <- ggplot(customer_check, aes(x = factor(fraction_label))) +
geom_bar(fill = "lightblue", color = "black") +
geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 8) +  # Increase data labels font size
labs(
title = "Surveyed customers/Number of households",
x = "Fraction Label",
y = "Frequency"
) +
scale_x_discrete(labels = c("0-0.25", "0.25-0.50", "0.50-0.75", "0.75-1")) +  # Adjust x-axis labels if needed
theme_minimal() +
theme(
axis.title = element_text(size = 20),  # Increase axis labels font size
axis.text = element_text(size = 20),   # Increase axis ticks font size
plot.title = element_text(size = 20)   # Increase plot title font size
)
p1
pacman::p_load(tidyverse, dplyr, here, sf, ggplot2, readxl, writexl, janitor, randomizr, stargazer, olsrr)
getwd()
#Dropbox path----
if (Sys.getenv("USERNAME") == "wb614406"){
DROPBOX <- file.path("C:/Users/wb614406/Dropbox")
}
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data"
)
output_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/outputs"
)
four_district_2404 <- read_xlsx(data_path, "four_district_2404.xlsx")
four_district_2404 <- read_xlsx(data_path, "four_districts_2404.xlsx")
four_district_2404 <- read_xlsx(data_path, "four_district_2404.xlsx")
data_path <- file.path(
DROPBOX,
"Rwanda Energy/datawork/RCT_data",
"baseline/data/data"
)
four_district_2404 <- read_xlsx( path = file.path(data_path, "four_district_2404.xlsx"))
scope_0408 <- read_xlsx( path = file.path(data_path, "Scope villages_040824.xlsx"))
karongi_head <- read_xlsx(path = file.path (data_path, "hh_head", "KARONGI HH Heads.xlsx"))
rulindo_head <- read_xlsx(path = file.path (data_path, "hh_head", "Copie de Rulindo_Heads_of_HHs.xlsx"))
rutsiro_head <- read_xlsx(path = file.path (data_path, "hh_head", "RUTSIRO HH Heads.xlsx"))
rusizi_head <- read_xlsx(path = file.path (data_path, "hh_head", "RUSIZI HOUSEHOLDS DATA PROVIDED TO EDCL 2023.xlsx"))
scope_info <- read_xlsx(path = file.path(data_path, "Scope Villages.xlsx"))
View(scope_info)
View(scope_0408)
View(karongi_head)
source("C:/Users/wb614406/github/rwanda-energy-project/RCT_data/baseline/scripts/hh_head.R", echo=TRUE)
karongi_head_join<- karongi_head %>%
clean_names() %>%
select(code, status, category, first_name, last_name, gender) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name)
)
View(karongi_head_join)
karongi_head_join<- karongi_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name)
)
karongi_head_join<- karongi_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
karongi_head_join<- karongi_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender, NID) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
#clean rulindo----
rulindo_head_join<- rulindo_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
karongi_head_join<- karongi_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
#clean rulindo----
rulindo_head_join<- rulindo_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
#clean rutsiro----
rutsiro_head_join<- rutsiro_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
rutsiro_head_join<- rutsiro_head %>%
clean_names() %>%
rename(
category = cat,
code = code_hh,
last_name = lastname,
gender = sex,
nid = id
) %>%
filter(category == 1) %>%
mutate(
status == NA
) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
rutsiro_head_join<- rutsiro_head %>%
clean_names() %>%
rename(
category = cat,
code = code_hh,
last_name = lastname,
gender = sex,
nid = id
) %>%
filter(category == 1) %>%
mutate(
status = NA
) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
rusizi_head_join<- rusizi_head %>%
clean_names() %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
#clean rusizi----
rusizi_head_join<- rusizi_head %>%
clean_names() %>%
mutate(
status = NA
) %>%
filter(category == 1) %>%
select(code, status, category, first_name, last_name, gender, nid) %>%
mutate(
first_name = str_to_title(first_name),
last_name = str_to_title(last_name),
first_name = ifelse(first_name %in% c("X", "Xxx", "."), NA, first_name),
last_name = ifelse(last_name %in% c("X", "Xxx", "."), NA, last_name),
village_id = substr(code, 1, 8)
)
View(rulindo_head_join)
View(rutsiro_head_join)
View(rutsiro_head_join)
head_join <- rbind(karongi_head_join, rulindo_head_join, rutsiro_head_join, rusizi_head_join)
View(head_join)
View(scope_info)
View(scope_info)
View(scope_0408)
rwa_villages <- st_read(dsn = file.path(data_path, "rwa_villages", "Village.shp"))
village_list <- rwa_villages %>%
st_drop_geometry()
View(village_list)
village_list_join <- village_list %>%
rename(
provinceid_key = Prov_ID,
province_key = Province,
districtid_key = Distr_ID,
district_key = District,
sectorid_key = Sector_ID,
sector_key = Sector,
cellid_key = Cell_ID,
cell_key = Cell,
villageid_key = Village_ID,
village_key = Name
) %>%
filter(district %in% c("Karongi", "Rulindo", "Rutsiro", "Rusizi"))
village_list_join <- village_list %>%
rename(
provinceid_key = Prov_ID,
province_key = Province,
districtid_key = Distr_ID,
district_key = District,
sectorid_key = Sector_ID,
sector_key = Sector,
cellid_key = Cell_ID,
cell_key = Cell,
villageid_key = Village_ID,
village_key = Name
) %>%
filter(district_key %in% c("Karongi", "Rulindo", "Rutsiro", "Rusizi"))
household_head <- left_join(village_list_join, head_join, by = c("villageid_key" = "village_id"))
View(household_head)
village_list_join <- village_list %>%
rename(
provinceid_key = Prov_ID,
province_key = Province,
districtid_key = Distr_ID,
district_key = District,
sectorid_key = Sector_ID,
sector_key = Sector,
cellid_key = Cell_ID,
cell_key = Cell,
villageid_key = Village_ID,
village_key = Name
) %>%
select(provinceid_key, province_key, districtid_key, district_key, sectorid_key, sector_key, cellid_key, cell_key, villageid_key, village_key) %>%
filter(district_key %in% c("Karongi", "Rulindo", "Rutsiro", "Rusizi"))
household_head <- left_join(village_list_join, head_join, by = c("villageid_key" = "village_id"))
n_distinct(household_head$nid) = nrow(household_head)
n_distinct(household_head$nid) == nrow(household_head)
household_head_unique <- household_head %>%
filter(status != c("Moved", "Duplicate"))
household_head_unique <- household_head %>%
filter(status != c("Moved", "Duplicate")) %>%
distinct(nid, .keep_all = TRUE)
household_head_check <- household_head %>%
group_by(village_id) %>%
summarise( n = n())
household_head_check <- household_head %>%
group_by(villageid_key) %>%
summarise( n = n())
four_district_check <- left_join(four_district_2404, household_head_check, by = c("village_id" = "villageid_key"))
View(household_head_check)
filter <- four_district_check %>%
filter(ubudehe_1 != n )
View(filter)
filter <- four_district_check %>%
filter(ubudehe_1 != n & status == "newly") %>%
filter <- four_district_check %>%
filter(ubudehe_1 != n & status == "newly")
filter <- four_district_check %>%
filter(ubudehe_1 != n & status == "newly")
View(filter)
filter <- four_district_check %>%
filter(ubudehe_1 != n & status == "newly" & n < 20)
View(filter)
View(household_head)
household_head_check <- household_head %>%
group_by(villageid_key) %>%
summarise( n = n()) %>%
filter(district_key == c("Karongi", "Rulindo", "Rutsiro", "Rusizi"))
household_head <- left_join(village_list_join, head_join, by = c("villageid_key" = "village_id"))
household_head_check <- household_head %>%
group_by(villageid_key) %>%
summarise( n = n()) %>%
filter(district_key == c("Karongi", "Rulindo", "Rutsiro", "Rusizi"))
household_head_check <- household_head %>%
group_by(villageid_key) %>%
summarise( n = n()) %>%
filter(district == c("Karongi", "Rulindo", "Rutsiro", "Rusizi"))
household_head_check <- household_head %>%
filter(district_key == c("Karongi", "Rulindo", "Rutsiro", "Rusizi")) %>%
group_by(villageid_key) %>%
summarise( n = n()) %>%
four_district_check <- left_join(four_district_2404, household_head_check, by = c("village_id" = "villageid_key"))
household_head_check <- household_head %>%
filter(district_key == c("Karongi", "Rulindo", "Rutsiro", "Rusizi")) %>%
group_by(villageid_key) %>%
summarise( n = n())
View(household_head_check)
household_head <- left_join(village_list_join, head_join, by = c("villageid_key" = "village_id"))
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly")
View(filter)
filter <- four_district_check %>%
filter(ubudehe_1 < n & status == "newly")
View(filter)
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly") %>%
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly")
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly")
View(filter)
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly" & n<20)
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly" & n<30)
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly") %>%
rename( hh_head_name = n) %>%
select(village_id, name, cell, sector, district, province, ubudehe_1, hh_head_name)
write_xlsx(filter, path = data_path(output_path, household_head_mismatch.xlsx))
write_xlsx(filter, path = file.path(output_path, household_head_mismatch.xlsx))
write_xlsx(filter, path = file.path(output_path, "household_head_mismatch.xlsx"))
household_head_chek <- household_head %>%
group_by(villageid_key) %>%
summarise( n = n())
four_district_check <- left_join(four_district_2404, household_head_check, by = c("village_id" = "villageid_key"))
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly") %>%
rename( hh_head_name = n) %>%
select(village_id, name, cell, sector, district, province, ubudehe_1, hh_head_name)
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly" & scope_2403 == 1) %>%
rename( hh_head_name = n) %>%
select(village_id, name, cell, sector, district, province, ubudehe_1, hh_head_name)
household_head_check <- household_head %>%
group_by(villageid_key) %>%
summarise( n = n())
four_district_check <- left_join(four_district_2404, household_head_check, by = c("village_id" = "villageid_key"))
filter <- four_district_check %>%
filter(ubudehe_1 > n & status == "newly" & scope_2403 == 1) %>%
rename( hh_head_name = n) %>%
select(village_id, name, cell, sector, district, province, ubudehe_1, hh_head_name)
View(scope_0408)
four_district_scope <- four_district_2404 %>%
filter(status == "newly " & scope_2403 == 1)
View(four_district_scope)
four_district_scope <- four_district_2404 %>%
filter(status == "newly" & scope_2403 == 1)
household_head_scope <- household_head %>%
filter(villageid_key %in% four_district_scope$village_id)
household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = nrow()
)
household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = nrow(.)
)
household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
household_head_scope_check <- household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)  %>% filter(n < 20)
View(household_head_scope_check)
household_head_scope_check <- household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
View(household_head_scope)
household_head_scope <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(hh_index = group_indices())
View(household_head_scope)
household_head_scope <- household_head %>%
filter(villageid_key %in% four_district_scope$village_id)
household_head_scope_check <- household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
household_head_scope <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(hh_index = paste0(villageid_key, "_", row_number()))
household_head_scope <- household_head %>%
filter(villageid_key %in% four_district_scope$village_id)
household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
household_head_scope_check <- household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
household_head_scope.1 <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(hh_index = paste0(villageid_key, "_", row_number()))
View(household_head_scope.1)
write_xlsx(household_head_scope.1, path = file.path(data_path, "household_head.xlsx"))
household_head_scope.1 <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(hh_index = paste0(villageid_key, "_", row_number())) %>%
filter(status != c("Duplicate", "Moved"))
household_head_scope.1 <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(hh_index = paste0(villageid_key, "_", row_number())) %>%
filter(status != "Duplicate" & status != "Moved")
household_head_scope.1 <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(hh_index = paste0(villageid_key, "_", row_number())) %>%
filter(status != "Duplicate")
household_head_scope.1 <- household_head_scope %>%
group_by(villageid_key) %>%
mutate(
hh_index = paste0(villageid_key, "_", row_number()),
status = ifelse(is.na(status), "Regular", status)
) %>%
filter(status == "Regular")
write_xlsx(household_head_scope.1, path = file.path(data_path, "household_head.xlsx"))
household_number <- household_head_scope %>%
group_by(villageid_key) %>%
summarize(
n = n()
)
write_xlsx(household_number, path = file.path(data_path, "household_number.xlsx"))
View(household_number)
