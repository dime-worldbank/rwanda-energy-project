library(rgee)
install.packages("rgee")
library(rgee)
ee_Initialize(drive = TRUE)
if(downloadlandsat8) {
#### KARONGI ####
kls <- ee$ImageCollection("LANDSAT/LC08/C02/T1_L2") %>%
ee$ImageCollection$filterDate("2014-05-01", "2018-09-30") %>%
ee$ImageCollection$filterBounds(kbbox) %>%
# https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2
# B, G, R, NIR, SWIR1
ee$ImageCollection$select(c("SR_B2", "SR_B3", "SR_B4", "SR_B5", "SR_B6", "QA_PIXEL"))
ktmp <- tempdir()
kls_task <- ee_imagecollection_to_local(
ic = kls, region = kbbox, dsn = file.path(ktmp, "drive_"), via = "drive",
scale = 30, description = "klandsat"
)
kls_paths <- list.files(ktmp, full.names = T) %>%
(function(x) x %>% subset(x %>% grepl(pattern = paste0(ktmp, "/drive_"), fixed = T)))
for(f in kls_paths) {
file.copy(from = f,
to = paste0("/home/jal/Dropbox/Irrigation_Rwanda/Data/geo/202107landsat/k8",
f %>% gsub(pattern = ktmp, replacement = "")))
}
data_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/admin_data"
)
pacman::p_load(knitr, raster, lfe,fixest, modelsummary, stargazer, tidyverse, dplyr, here, sf, haven, ggplot2, readxl,  writexl, janitor, randomizr, RCT, purrr, RODBC, DBI)
pacman::p_load(knitr, raster, lfe,fixest, modelsummary, stargazer, tidyverse, dplyr, here, sf, haven, ggplot2, readxl,  writexl, janitor, randomizr, RCT, purrr, RODBC, DBI)
getwd()
dropbox <- 'C:/Users/wb614406/Dropbox'
data_path <- file.path(
dropbox,
"Rwanda Energy/EAQIP/datawork/admin_data"
)
library(raster)
rwa_villages <- st_read(dsn = file.path(data_path,"rwa_villages", "Village.shp"))
rwa_villages <- st_make_valid(rwa_villages)
karongi_villages <- rwa_villages %>%
filter(District == "Karongi")
plot(karongi_building)
karongi_building <-  raster(file.path(data_path, "karongi_openbuildings_2.5.tif"))
karongi_villages <- st_transform(karongi_villages, crs = st_crs(karongi_building))
plot(karongi_building)
View(karongi_villages)
karongi_rubengera_sp <- as_Spatial(karongi_rubengera)
karongi_rubengera <- karongi_villages %>%
filter(Sector == "Rubengera")
karongi_rubengera_sp <- as_Spatial(karongi_rubengera)
karongi_buildings_crop <- crop(karongi_building, extent(karongi_rubengera_sp))
karongi_buildings_masked <- mask(karongi_buildings_crop, karongi_rubengera_sp)
# Plot the result
plot(karongi_buildings_masked)
karongi_rubengera <- karongi_villages %>%
filter(Sector == "Rubengera" & Name == "Bigugu")
karongi_rubengera_sp <- as_Spatial(karongi_rubengera)
karongi_buildings_crop <- crop(karongi_building, extent(karongi_rubengera_sp))
karongi_buildings_masked <- mask(karongi_buildings_crop, karongi_rubengera_sp)
# Plot the result
plot(karongi_buildings_masked)
library(rgee)
ee_Initialize(drive = TRUE)
ee_Initialize()
ee$ImageCollection("COPERNICUS/S2_SR")$size()$getInfo()
# Save the cropped and masked raster (optional)
writeRaster(karongi_buildings_masked,
filename = file.path(data_path, "Bigugu_buildings_2.5.tif"),
format = "GTiff", overwrite = TRUE)
## install`reticulate`, only one time
if (!("reticulate" %in% installed.packages()[,1])) {
print("Installing package `reticulate`...")
install.packages("reticulate")
} else {
print("Package `reticulate` already installed") }
Sys.which("python")   # system default
library(reticulate)
Sys.which("python")   # system default
Sys.which("python3")
use_python(Sys.which("python3"))
use_python(Sys.which("python"))
use_python(Sys.which("python3"))
use_python(Sys.which("python3"))
library(reticulate)
Sys.which("python")   # system default
Sys.which("python3")
use_python(Sys.which("python3"))
use_python(Sys.which("python"))
use_python("C:\Users\wb614406\AppData\Local\Microsoft\WindowsApps\python3.exe")
Sys.which("python")   # system default
use_python("C:/Users/wb614406/AppData/Local/Microsoft/WindowsApps/python3.exe")
use_python("C:/Users/wb614406/AppData/Local/Microsoft/WindowsApps/python.exe")
View(karongi_rubengera)
use_python("C:/Users/wb614406/AppData/Local/Microsoft/WindowsApps/python.exe")
Sys.which("python")   # system default
rgee::ee_install()
rgee::ee_install()
library(rgee)
rgee::ee_install()
library(reticulate)
use_python("C:\Users\wb614406\AppData\Local\Microsoft\WindowsApps\python.exe")
rgee::ee_install()
ee_clean_pyenv()
rgee::ee_install()
